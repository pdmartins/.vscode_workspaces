---
applyTo: '**'
---
# Copilot Instructions - Workflow Engine

<engine-loader critical="true">
  <mandate>Este arquivo governa TODAS as operaÃ§Ãµes no workspace</mandate>
  <mandate>SEMPRE carregue core/workflow-engine.md antes de qualquer aÃ§Ã£o</mandate>
  <mandate>InstruÃ§Ãµes sÃ£o OBRIGATÃ“RIAS, nÃ£o sugestÃµes</mandate>
  <mandate>Execute workflows em ORDEM EXATA</mandate>
</engine-loader>

## Engine Initialization

<workflow id="initialization" trigger="on-conversation-start">
  <step n="1" goal="Carregar motor de execuÃ§Ã£o">
    <load critical="true">{workspace}/.github/instructions/core/workflow-engine.md</load>
    <action>Internalizar todas as regras do workflow engine</action>
  </step>

  <step n="2" goal="Identificar contexto">
    <action>Detectar tipo de arquivo sendo trabalhado</action>
    <action>Carregar instruÃ§Ãµes especÃ­ficas apropriadas</action>
  </step>
</workflow>

## Regras Fundamentais

<rules critical="true">
  <rule id="language">
    <chat>PortuguÃªs brasileiro</chat>
    <code>InglÃªs (variÃ¡veis, funÃ§Ãµes, parÃ¢metros, nomes de arquivo)</code>
  </rule>
  
  <rule id="no-auto-docs">
    NUNCA crie arquivos markdown/logs para documentar atividades automaticamente.
    Apenas crie/atualize quando explicitamente solicitado.
  </rule>
</rules>

## Projeto

Scripts utilitÃ¡rios de automaÃ§Ã£o â€” idempotentes, bilÃ­ngues (PT na raiz, EN em `.english-version/`), multiplataforma.

<structure>
scripts/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ instructions/          # InstruÃ§Ãµes Copilot
â”‚   â”‚   â”œâ”€â”€ core/              # Motor de workflow
â”‚   â”‚   â”‚   â””â”€â”€ workflow-engine.md
â”‚   â”‚   â”œâ”€â”€ skills/            # Skills sob demanda
â”‚   â”‚   â”‚   â”œâ”€â”€ bash.md
â”‚   â”‚   â”‚   â”œâ”€â”€ powershell.md
â”‚   â”‚   â”‚   â”œâ”€â”€ readme.md
â”‚   â”‚   â”‚   â””â”€â”€ sync.md
â”‚   â”‚   â””â”€â”€ default.instructions.md
â”‚   â””â”€â”€ .memory/               # LiÃ§Ãµes aprendidas
â”œâ”€â”€ .english-version/          # VersÃ£o inglÃªs
â”œâ”€â”€ azure/                     # Scripts Azure
â”œâ”€â”€ docker/                    # Scripts Docker  
â”œâ”€â”€ oh-my-posh/               # Scripts Oh My Posh
â””â”€â”€ ssh/                       # Scripts SSH
</structure>

## Skills (InstruÃ§Ãµes sob Demanda)

<skills-catalog>
  | Skill | Arquivo | Quando carregar |
  |-------|---------|-----------------|
  | bash | `skills/bash.md` | Criar/editar arquivos *.sh |
  | powershell | `skills/powershell.md` | Criar/editar arquivos *.ps1 |
  | readme | `skills/readme.md` | Criar/editar README.md |
  | sync | `skills/sync.md` | ApÃ³s modificar qualquer script |
</skills-catalog>

<skill-loading critical="true">
  <mandate>Ao trabalhar com arquivos *.sh, VOCÃŠ DEVE ler e aplicar: {workspace}/.github/instructions/skills/bash.md</mandate>
  <mandate>Ao trabalhar com arquivos *.ps1, VOCÃŠ DEVE ler e aplicar: {workspace}/.github/instructions/skills/powershell.md</mandate>
  <mandate>Ao trabalhar com README.md, VOCÃŠ DEVE ler e aplicar: {workspace}/.github/instructions/skills/readme.md</mandate>
  <mandate>ApÃ³s modificar scripts, VOCÃŠ DEVE ler e aplicar: {workspace}/.github/instructions/skills/sync.md</mandate>
</skill-loading>

## File Detection Workflow

<workflow id="file-detection" trigger="on-file-context">
  <step n="1" goal="Detectar tipo e carregar skill apropriada">
    <check if="contexto envolve arquivo *.sh OU pedido para criar script bash">
      <action>Ler COMPLETAMENTE: {workspace}/.github/instructions/skills/bash.md</action>
      <action>Aplicar todos os padrÃµes e templates do skill</action>
    </check>
    
    <check if="contexto envolve arquivo *.ps1 OU pedido para criar script PowerShell">
      <action>Ler COMPLETAMENTE: {workspace}/.github/instructions/skills/powershell.md</action>
      <action>Aplicar todos os padrÃµes e templates do skill</action>
    </check>
    
    <check if="contexto envolve README.md">
      <action>Ler COMPLETAMENTE: {workspace}/.github/instructions/skills/readme.md</action>
      <action>Aplicar estrutura obrigatÃ³ria</action>
    </check>
  </step>

  <step n="2" goal="PÃ³s-modificaÃ§Ã£o">
    <check if="script foi criado ou modificado">
      <action>Ler COMPLETAMENTE: {workspace}/.github/instructions/skills/sync.md</action>
      <action>Executar workflow de sincronizaÃ§Ã£o</action>
    </check>
  </step>
</workflow>

## Nomenclatura

| Tipo | PadrÃ£o | Exemplo |
|------|--------|---------|
| Arquivos | `verbo-substantivo.{ps1,sh}` | `install-docker.ps1` |
| FunÃ§Ãµes PS | `Verb-Noun` | `Test-Administrator` |
| FunÃ§Ãµes Bash | `snake_case` | `check_privileges` |
| VariÃ¡veis PS | `$PascalCase` | `$UserProfile` |
| VariÃ¡veis Bash | `snake_case` / `UPPER_CASE` | `user_home` / `RED` |

## Emojis & Cores

| Emoji | Uso | Cor PS | Cor Bash |
|-------|-----|--------|----------|
| ğŸ” | Verificando | Cyan | `\033[0;36m` |
| ğŸ“¦ | Instalando | Yellow | `\033[1;33m` |
| âœ… | Sucesso | Green | `\033[0;32m` |
| âŒ | Erro | Red | `\033[0;31m` |
| âš ï¸ | Aviso | Yellow | `\033[1;33m` |
| ğŸ”„ | Atualizando | Cyan | `\033[0;36m` |
| ğŸš€ | Executando | White | `\033[1;37m` |

## SeguranÃ§a

<forbidden>
  - Senhas, tokens, API keys
  - IDs de tenant/subscription/recursos
  - Paths absolutos: `C:\Users\...`, `D:\Repos\...`, `/home/...`
  - URLs hardcoded de repos especÃ­ficos
</forbidden>

<safe-paths>
  <powershell>$env:USERPROFILE, $env:APPDATA, $env:TEMP, $PSScriptRoot</powershell>
  <bash>$HOME, $XDG_CONFIG_HOME, /tmp, ${BASH_SOURCE[0]}</bash>
</safe-paths>

## Validation Workflow

<workflow id="pre-completion-validation" trigger="before-task-complete">
  <step n="1" goal="Validar script">
    <validate condition="script Ã© idempotente">
      <halt if="false" reason="Script deve verificar estado antes de alterar"/>
    </validate>
    
    <validate condition="verifica prÃ©-requisitos">
      <halt if="false" reason="Script deve verificar dependÃªncias"/>
    </validate>
    
    <validate condition="usa emojis e cores consistentes">
      <halt if="false" reason="Seguir padrÃ£o de emojis do projeto"/>
    </validate>
    
    <validate condition="tem tratamento de erros">
      <halt if="false" reason="Adicionar try/catch ou set -e"/>
    </validate>
    
    <validate condition="sem dados sensÃ­veis">
      <halt if="false" reason="Remover senhas, tokens, paths absolutos"/>
    </validate>
  </step>

  <step n="2" goal="Validar sincronizaÃ§Ã£o">
    <validate condition="versÃ£o EN existe ou serÃ¡ criada">
      <halt if="false" reason="Criar versÃ£o em .english-version/"/>
    </validate>
    
    <validate condition="README atualizado (se mudanÃ§a funcional)">
      <halt if="false" reason="Atualizar README com mudanÃ§as"/>
    </validate>
  </step>
</workflow>

## Checklist ObrigatÃ³rio

<checklist context="qualquer-script" execute="always">
  - [ ] Idempotente
  - [ ] Verifica prÃ©-requisitos
  - [ ] Cores e emojis consistentes
  - [ ] Feedback de progresso
  - [ ] Tratamento de erros
  - [ ] VersÃ£o PT e EN
  - [ ] README atualizado
  - [ ] Sem dados sensÃ­veis
  - [ ] Sem paths absolutos
</checklist>

