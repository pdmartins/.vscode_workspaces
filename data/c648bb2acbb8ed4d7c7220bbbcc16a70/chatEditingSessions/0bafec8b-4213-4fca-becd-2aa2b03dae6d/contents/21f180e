---
name: agent-turn-reflect
description: Reflex√£o autom√°tica ao final de cada turno do agente. Analisa o conte√∫do da conversa para detectar atualiza√ß√µes necess√°rias em contexto do projeto (6 subtipos), mem√≥ria do agente (4 categorias), skills e chat-memory. Comportamento adaptativo ‚Äî triage r√°pido em todos os turnos, aprofunda apenas quando detecta algo relevante. Silencioso quando nada h√° a fazer. Triggers: autom√°tico no final de cada turno do agente.
metadata:
  author: copilot-core
  version: "2.0"
  category: agent
  delegable: none
---

# Agent Turn Reflect

Reflex√£o autom√°tica per-turn. Analisa a conversa e atualiza contexto, mem√≥rias e chat-memory incrementalmente.

## Quando Usar

- **Automaticamente** ao final de cada turno do agente
- √â a √öLTIMA coisa que o agente faz antes de entregar a resposta

## Quando N√ÉO Usar

- Nunca pular ‚Äî o triage r√°pido (Fase 0) √© quem decide se h√° algo a fazer
- N√£o usar como substituto de `agent-action-review` (que valida completude p√≥s-task-manage)

## Workflow

### Fase 0 ‚Äî Triage R√°pido

Checklist mental (N√ÉO exibir ao usu√°rio):

| Pergunta | Se "sim" ‚Üí prosseguir para |
|----------|---------------------------|
| Houve decis√£o arquitetural, t√©cnica ou de processo? | Fase 3 (Mem√≥ria) |
| Houve mudan√ßa de stack, restri√ß√£o, integra√ß√£o ou estado do projeto? | Fase 1 (Contexto) |
| Houve gap, erro ou melhoria identificada em alguma skill? | Fase 2 (Skills) |
| Houve progresso report√°vel (arquivos criados/editados, tarefas conclu√≠das)? | Fase 4 (Chat Memory) |
| Houve cria√ß√£o/altera√ß√£o de artefatos de c√≥digo? | Fase 0.5 (Code Map) |

**Se TODAS "n√£o"** ‚Üí skip silencioso, sem output algum.

### Fase 0.5 ‚Äî Code Map (se detectado)

Se artefatos foram criados ou alterados ‚Üí executar `project-codemap-update` automaticamente.

### Fase 1 ‚Äî Contexto do Projeto

Analisar se a conversa revelou mudan√ßas em algum subtipo de contexto:

| Subtipo | Pasta | Exemplos |
|---------|-------|----------|
| Architecture | `context/architecture/` | Decis√£o de estrutura, padr√£o de design |
| Business Rules | `context/business-rules/` | Nova restri√ß√£o, regra de dom√≠nio |
| Conventions | `context/conventions/` | Nova conven√ß√£o de naming, processo |
| Infrastructure | `context/infrastructure/` | Mudan√ßa de stack, nova integra√ß√£o |
| Team Process | `context/team-process/` | Mudan√ßa de workflow SDLC |

**Se detectar** ‚Üí executar `project-context-update` com o subtipo correto (sem perguntar).

### Fase 2 ‚Äî Skills

Analisar se a conversa revelou gap ou melhoria em skill.

**Se detectar** ‚Üí **PERGUNTAR ao usu√°rio** antes de qualquer altera√ß√£o:

```
‚ùì **Preciso de clarifica√ß√£o**: Detectei que {descri√ß√£o} no skill `{nome}`. Faz sentido atualizar?
```

### Fase 3 ‚Äî Mem√≥ria do Agente

Analisar se a conversa cont√©m decis√µes/padr√µes n√£o capturados pelos auto-registers reativos:

| Categoria | Pasta | Exemplos |
|-----------|-------|----------|
| Preferences | `memory/preferences/` | Estilo escolhido, abordagem preferida |
| Patterns | `memory/patterns/` | Padr√£o aprendido, conven√ß√£o descoberta |
| Decisions | `memory/decisions/` | Decis√£o t√©cnica com rationale |
| Concepts | `memory/concepts/` | Conceito relevante aprendido |

**Se detectar** ‚Üí executar `agent-memory-update` com a categoria correta (autom√°tico).

### Fase 4 ‚Äî Chat Memory Incremental

Fazer append ao arquivo de chat-memory da sess√£o atual.

**Primeiro turno substantivo:** Criar `YYYY-MM-DD_{topico}.md` em `chat-memory/`.
**Turnos seguintes:** Append se√ß√£o `## Turn: HH:MM` com 2-3 frases.
**Turnos triviais:** N√ÉO fazer append.

## Output

- **Nada detecta**: Sil√™ncio total
- **Atualiza algo**: `üîÑ {tipo}: {descri√ß√£o curta}`
- **Prop√µe skill**: Formato de pergunta (Fase 2)

## Intera√ß√£o com Outros Skills

| Skill | Rela√ß√£o |
|-------|---------|
| `agent-memory-update` | Delegado pela Fase 3 |
| `project-context-update` | Delegado pela Fase 1 |
| `project-codemap-update` | Delegado pela Fase 0.5 |
| `agent-chat-save` | Fase 4 usa modo incremental |
| `agent-action-review` | Independente ‚Äî action-review √© p√≥s-task-manage |
