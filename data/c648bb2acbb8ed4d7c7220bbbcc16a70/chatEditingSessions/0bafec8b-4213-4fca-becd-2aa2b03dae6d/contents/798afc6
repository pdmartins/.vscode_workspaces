---
name: agent-action-review
description: Valida completude e consist√™ncia das a√ß√µes realizadas pelo agente. Verifica se side-effects obrigat√≥rios foram executados (codemap, mem√≥ria, contexto, contagens em instructions/cat√°logos). Disparado automaticamente ap√≥s agent-task-manage completar todas as tarefas, ou sob demanda. Triggers: "revisa o que fez", "verifica", "t√° tudo certo?", "valida a√ß√µes", auto ap√≥s task-manage completar.
metadata:
  author: copilot-core
  version: "1.0"
  category: agent
  delegable: full
---

# Agent Action Review

Valida completude e consist√™ncia cross-artefato das a√ß√µes do agente.

## Quando Usar

- **Automaticamente** ap√≥s `agent-task-manage` completar todas as tarefas (antes de `agent-chat-save`)
- Sob demanda quando o usu√°rio pedir para "revisar", "verificar", "t√° tudo certo?"
- Ap√≥s sess√µes complexas com m√∫ltiplos arquivos alterados

## Quando N√ÉO Usar

- Tarefas simples (1-3 steps, arquivo √∫nico)
- Consultas de informa√ß√£o (read-only)
- Valida√ß√£o de qualidade de c√≥digo (usar `code-review-analyze`)
- Valida√ß√£o de estrutura de SKILL.md (usar `skill-output-validate`)

## Workflow

### 1. Coletar invent√°rio de a√ß√µes

Listar todas as a√ß√µes realizadas na sess√£o/tarefa:

| Tipo de A√ß√£o | O que verificar |
|-------------|----------------|
| Arquivo criado | Path, tipo do artefato |
| Arquivo modificado | Path, natureza da mudan√ßa |
| Skill criado/alterado | Nome, tipo, localiza√ß√£o |
| Instru√ß√£o alterada | Qual instruction file, o que mudou |
| Decis√£o tomada | Natureza, impacto |

### 2. Aplicar checklist de side-effects

Para cada a√ß√£o identificada, verificar se os side-effects obrigat√≥rios foram executados:

#### C√≥digo criado/modificado ‚Üí Codemap atualizado?

| Verifica√ß√£o | Como |
|-------------|------|
| `project-codemap-update` foi chamado? | Verificar se artefatos novos est√£o no code-map |
| Artefatos no code-map correspondem a arquivos reais? | Cross-check paths |

#### Decis√£o arquitetural tomada ‚Üí Mem√≥ria registrada?

| Verifica√ß√£o | Como |
|-------------|------|
| Decis√£o √© significativa? | Impacta estrutura, padr√µes, ou workflow |
| `agent-memory-register` foi chamado? | Verificar se li√ß√£o foi adicionada |
| Categoria correta? | `arquitetura`, `padr√µes`, `regras`, etc. |

#### Stack/restri√ß√£o mudou ‚Üí Contexto atualizado?

| Verifica√ß√£o | Como |
|-------------|------|
| Mudan√ßa afeta stack, integra√ß√£o, ou restri√ß√£o? | Avaliar natureza da mudan√ßa |
| `project-context-update` foi chamado? | Verificar se project.md reflete a mudan√ßa |

#### Skill criado/alterado ‚Üí Instructions sincronizadas?

| Verifica√ß√£o | Como |
|-------------|------|
| Capability Manifest atualizado? | `agent-skills-core.instructions.md`, `agent-skills-project.instructions.md`, template |
| Contagem por tipo correta? | Verificar coluna Qtd no Manifest |
| Always-Known atualizado (se aplic√°vel)? | Lista de 10 skills no Manifest |
| Cat√°logo do tipo atualizado? | `{tipo}-catalog-query/SKILL.md` |
| `agent-subagent-delegate` atualizado? | Classifica√ß√£o `delegable` do novo skill |

#### Task-manage steps ‚Üí Completude real?

| Verifica√ß√£o | Como |
|-------------|------|
| Todos os steps planejados foram executados? | Comparar plan vs resultado |
| Algum step foi pulado ou simplificado? | Verificar se houve shortcuts |
| Steps descobertos durante execu√ß√£o foram adicionados? | Verificar se novos steps necess√°rios foram endere√ßados |

### 3. Gerar relat√≥rio

Formatar findings em relat√≥rio estruturado:

```
üîç **Review de A√ß√µes**

‚úÖ Codemap atualizado com {N} artefatos
‚úÖ Li√ß√£o registrada ‚Äî categoria: {cat}
‚ö†Ô∏è Capability Manifest em agent-skills-core.instructions.md n√£o atualizado (agent diz {X}, deveria ser {Y})
‚ö†Ô∏è Cat√°logo {tipo}-catalog-query n√£o inclui {skill-name}
üî¥ project-context-update n√£o chamado ‚Äî stack mudou mas context/project.md est√° desatualizado

**A√ß√µes necess√°rias**: {lista de corre√ß√µes}
```

### Severidades

| N√≠vel | Significado | Exemplo |
|-------|-------------|---------|
| ‚úÖ | OK ‚Äî side-effect executado corretamente | Codemap atualizado |
| ‚ö†Ô∏è | Faltou ‚Äî side-effect n√£o executado, impacto moderado | Contagem desatualizada em instructions |
| üî¥ | Inconsistente ‚Äî dados conflitantes entre artefatos | Skill existe mas n√£o est√° em nenhum cat√°logo/tabela |

### 4. Sugerir corre√ß√µes

Para cada finding ‚ö†Ô∏è ou üî¥, sugerir a a√ß√£o corretiva espec√≠fica:

```
‚ö†Ô∏è **Capability Manifest desatualizado**
‚Üí Atualizar `agent-skills-core.instructions.md`: coluna Qtd do tipo agent de {N} ‚Üí {N+2}
‚Üí Atualizar `templates/workspace.instructions.md`: mesma contagem
‚Üí Atualizar `agent-skills-project.instructions.md`: mesma contagem
```

### 5. Executar corre√ß√µes (se autorizado)

**Se auto-triggered** (ap√≥s task-manage):
‚Üí Aplicar corre√ß√µes automaticamente para findings ‚ö†Ô∏è (impacto moderado)
‚Üí Reportar findings üî¥ ao usu√°rio para decis√£o

**Se sob demanda** (usu√°rio pediu):
‚Üí Apresentar relat√≥rio completo
‚Üí Perguntar: "Quer que eu aplique as corre√ß√µes?"

## Cadeia de Finaliza√ß√£o

Quando `agent-task-manage` completa todas as tarefas, a cadeia √©:

```
agent-task-manage (todas completed)
  ‚Üí agent-action-review (valida side-effects e corrige)
    ‚Üí agent-impact-validate (valida cascata, se 3+ arquivos modificados)
      ‚Üí agent-chat-save (salva sess√£o se complexa)
```

O review roda **entre** task-manage completar e chat-save salvar, garantindo que a sess√£o salva reflete o estado correto.

**Quando chamar agent-impact-validate**: Se a sess√£o envolveu 3+ arquivos modificados, renames, ou altera√ß√µes em templates/instructions, o review DEVE chamar `agent-impact-validate` antes de finalizar.

## Checklist R√°pida

Para refer√™ncia durante a review:

- [ ] Arquivos criados est√£o no codemap?
- [ ] Decis√µes importantes registradas na mem√≥ria?
- [ ] Mudan√ßas de stack/restri√ß√£o refletidas no contexto?
- [ ] Capability Manifest consistente em todos os instructions (core, project, template)?
- [ ] Contagens por tipo corretas no Manifest?
- [ ] Cat√°logos incluem todos os skills do tipo?
- [ ] agent-subagent-delegate lista skills novos com classifica√ß√£o correta?
- [ ] Todos os steps do task-manage foram realmente executados?
