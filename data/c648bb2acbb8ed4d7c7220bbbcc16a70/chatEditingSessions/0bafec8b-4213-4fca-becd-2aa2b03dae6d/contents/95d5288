````skill
---
name: agent-impact-validate
description: Valida impacto em cascata de ediÃ§Ãµes multi-arquivo. Verifica referÃªncias cruzadas, consistÃªncia de nomes/paths/contagens, e integridade de links internos. Complementa agent-action-review focando em efeitos colaterais nÃ£o-Ã³bvios. Triggers - "valida impacto", "verifica cascata", "checka referÃªncias", "consistÃªncia cross-file", auto apÃ³s ediÃ§Ãµes em 3+ arquivos.
metadata:
  author: copilot-core
  version: "1.0"
  category: agent
  delegable: full
---

# Agent Impact Validate

Valida impacto em cascata apÃ³s ediÃ§Ãµes multi-arquivo. Foca em efeitos colaterais nÃ£o-Ã³bvios que `agent-action-review` nÃ£o cobre (referÃªncias quebradas, contagens desatualizadas, nomes renomeados inconsistentemente).

## Quando Usar

- **Automaticamente** quando `agent-action-review` detecta ediÃ§Ãµes em 3+ arquivos
- ApÃ³s renomear arquivos, skills, ou paths referenciados em mÃºltiplos locais
- ApÃ³s alterar templates que sÃ£o fonte de verdade para outros arquivos
- ApÃ³s modificar instruction files (symlinks, manifests, contagens)
- Sob demanda: "valida impacto", "checka referÃªncias"

## Quando NÃƒO Usar

- EdiÃ§Ãµes em arquivo Ãºnico sem referÃªncias externas
- AlteraÃ§Ãµes read-only (consultas, queries)
- ValidaÃ§Ã£o de qualidade de cÃ³digo (usar `code-review-analyze`)
- ValidaÃ§Ã£o de completude de side-effects (usar `agent-action-review`)

## DiferenÃ§a de agent-action-review

| Aspecto | agent-action-review | agent-impact-validate |
|---------|--------------------|-----------------------|
| **Foco** | Side-effects obrigatÃ³rios foram executados? | EdiÃ§Ãµes criaram inconsistÃªncias? |
| **Quando** | ApÃ³s task-manage completar | ApÃ³s ediÃ§Ãµes multi-arquivo |
| **Escopo** | Codemap, memÃ³ria, contexto, contagens | ReferÃªncias, paths, nomes, links |
| **Natureza** | Checklist de completude | AnÃ¡lise de cascata |

## Workflow

### 1. Coletar grafo de impacto

Para cada arquivo modificado, identificar:

```
arquivo_modificado
  â”œâ”€â”€ referenciado_por: [lista de arquivos que apontam para ele]
  â”œâ”€â”€ referencia: [lista de arquivos que ele aponta]
  â””â”€â”€ tipo_mudanÃ§a: rename | content | delete | create
```

### 2. Analisar por tipo de mudanÃ§a

#### Rename de arquivo/path

| VerificaÃ§Ã£o | Como |
|-------------|------|
| ReferÃªncias ao path antigo ainda existem? | `grep_search` pelo path antigo no workspace |
| Symlinks apontam para path correto? | Verificar targets dos symlinks |
| Templates usam o nome correto? | Verificar `.copilot-core/.internal/templates/` |
| Skills referenciam o path correto? | Verificar SKILL.md que mencionam o arquivo |
| Instruction files atualizados? | Verificar ambos instruction files |

#### Rename de skill

| VerificaÃ§Ã£o | Como |
|-------------|------|
| CatÃ¡logo do tipo inclui novo nome? | `{tipo}-catalog-query/SKILL.md` |
| `agent-subagent-delegate` referencia novo nome? | Verificar classificaÃ§Ã£o delegable |
| Instruction files listam novo nome? | Capability Manifest + Always-Known |
| Outros skills que referenciam por nome atualizados? | grep pelo nome antigo |

#### AlteraÃ§Ã£o de contagens/nÃºmeros

| VerificaÃ§Ã£o | Como |
|-------------|------|
| Contagem de skills consistente? | Comparar Capability Manifest em todos os instructions |
| Contagem no project.md consistente? | Cross-check com instructions |
| VersÃµes de SKILL.md consistentes? | Comparar metadata |

#### AlteraÃ§Ã£o de template (fonte de verdade)

| VerificaÃ§Ã£o | Como |
|-------------|------|
| InstÃ¢ncias derivadas do template estÃ£o atualizadas? | Comparar templates vs instÃ¢ncias |
| Novos campos no template estÃ£o nos derivados? | Cross-check estruturas |
| Campos removidos do template foram limpos nos derivados? | Verificar campos obsoletos |

### 3. Executar validaÃ§Ãµes

Para cada par (arquivo_modificado, referenciador):

```
1. Ler o arquivo referenciador
2. Verificar se todas as referÃªncias ao item modificado estÃ£o corretas
3. Reportar inconsistÃªncias encontradas
```

### 4. Gerar relatÃ³rio de impacto

```
ğŸ” **ValidaÃ§Ã£o de Impacto em Cascata**

ğŸ“Š Grafo: {N} arquivos modificados â†’ {M} referÃªncias verificadas

âœ… `.github/instructions/` â€” symlinks corretos
âœ… `.copilot-core/.internal/templates/workspace.instructions.md` â€” contagens corretas
âš ï¸ `.copilot-core/skills/project/project-setup-bootstrap/SKILL.md` â€” referencia path antigo `default.instructions.md` na linha 42
ğŸ”´ `.copilot-project/context/project.md` â€” contagem diz 56 skills, deveria ser 58

**Impacto total**: {N} inconsistÃªncias ({X} âš ï¸, {Y} ğŸ”´)
```

### 5. Aplicar correÃ§Ãµes

**Modo automÃ¡tico** (integrado na cadeia de finalizaÃ§Ã£o):
â†’ Corrigir automaticamente: referÃªncias de path, contagens, nomes
â†’ Reportar ao usuÃ¡rio: mudanÃ§as estruturais que precisam de decisÃ£o

**Modo sob demanda**:
â†’ Apresentar relatÃ³rio completo + correÃ§Ãµes sugeridas
â†’ Perguntar: "Quer que eu aplique as correÃ§Ãµes?"

## Cadeia de FinalizaÃ§Ã£o (atualizada)

```
agent-task-manage (todas completed)
  â†’ agent-action-review (valida side-effects)
    â†’ agent-impact-validate (valida cascata, se 3+ arquivos)
      â†’ agent-chat-save (salva sessÃ£o se complexa)
```

## Checklist RÃ¡pida de Cascata

- [ ] Paths renomeados: grep pelo nome antigo encontra 0 resultados?
- [ ] Symlinks: todos resolvem para arquivos reais?
- [ ] Contagens: Capability Manifest consistente em todos os instructions?
- [ ] CatÃ¡logos: skills novos listados, skills removidos excluÃ­dos?
- [ ] Templates: instÃ¢ncias derivadas refletem mudanÃ§as do template?
- [ ] Cross-references: skills que referenciam outros skills usam nomes corretos?
- [ ] project.md: informaÃ§Ãµes refletem estado atual pÃ³s-ediÃ§Ãµes?

## Subagent Pattern

**Tipo**: `full` â€” pode ser delegado integralmente a subagent.

### Prompt Exemplo

```
runSubagent({
  description: "Validate cascade impact",
  prompt: "Leia .copilot-core/skills/agent/agent-impact-validate/SKILL.md. Arquivos modificados nesta sessÃ£o: {lista}. Para cada arquivo, identifique todos os referenciadores. Verifique consistÃªncia de paths, nomes, contagens. Retorne: relatÃ³rio de impacto com findings categorizados (âœ…/âš ï¸/ğŸ”´)."
})
```

````
