# Setup Scripts — Copilot Agent Skills

Scripts para plugar o sistema de skills em projetos-alvo. Referenciado por `project-workspace-create` e `project-setup-bootstrap`.

## Variáveis

| Variável | Descrição | Exemplo |
|----------|-----------|---------|
| `{nome-projeto}` | Nome/branch do projeto | `_bw/bewiser.assistant.api` |
| `{repo-core}` | URL do repo core | `https://github.com/pdmartins/.copilot-core.git` |
| `{repo-project}` | URL do repo project | `https://github.com/pdmartins/.copilot-project.git` |

---

## Modo Aberto (submodule — visível no repo)

### Windows (PowerShell)

```powershell
# Copilot Agent Skills - Setup (Modo Aberto)
git submodule add -b main {repo-core} .copilot-core
git submodule add -b {nome-projeto} {repo-project} .copilot-project
# Criar symlinks para instructions (via script automático)
& .copilot-core\.internal\config\setup-instructions.ps1
git add .
git commit -m "feat: add copilot agent"
```

### Linux/Mac (Bash)

```bash
# Copilot Agent Skills - Setup (Modo Aberto)
mkdir -p .github/instructions
git submodule add -b main {repo-core} .copilot-core
git submodule add -b {nome-projeto} {repo-project} .copilot-project
# Criar symlinks para instructions
ln -s ../../.copilot-core/instructions/agent-skills-core.instructions.md .github/instructions/agent-skills-core.instructions.md
ln -s ../../.copilot-project/instructions/agent-skills-project.instructions.md .github/instructions/agent-skills-project.instructions.md
git add .
git commit -m "feat: add copilot agent"
```

---

## Modo Stealth (clone + gitignore — invisível no repo)

### Windows (PowerShell)

```powershell
# Copilot Agent Skills - Setup (Modo Stealth)
git clone -b main {repo-core} .copilot-core
git clone -b {nome-projeto} {repo-project} .copilot-project
# Criar symlinks para instructions (via script automático)
& .copilot-core\.internal\config\setup-instructions.ps1
# Adicionar ao .gitignore
Add-Content .gitignore "`n# Copilot Agent Skills (local only)`n.copilot-core/`n.copilot-project/`n.github/instructions/agent-skills-core.instructions.md`n.github/instructions/agent-skills-project.instructions.md"
git add .gitignore
git commit -m "chore: gitignore copilot agent local files"
```

### Linux/Mac (Bash)

```bash
# Copilot Agent Skills - Setup (Modo Stealth)
git clone -b main {repo-core} .copilot-core
git clone -b {nome-projeto} {repo-project} .copilot-project
mkdir -p .github/instructions
ln -s ../../.copilot-core/instructions/agent-skills-core.instructions.md .github/instructions/agent-skills-core.instructions.md
ln -s ../../.copilot-project/instructions/agent-skills-project.instructions.md .github/instructions/agent-skills-project.instructions.md
# Adicionar ao .gitignore
cat >> .gitignore << 'EOF'

# Copilot Agent Skills (local only)
.copilot-core/
.copilot-project/
.github/instructions/agent-skills-core.instructions.md
.github/instructions/agent-skills-project.instructions.md
EOF
git add .gitignore
git commit -m "chore: gitignore copilot agent local files"
```

---

## Onboarding de novo dev (Modo Stealth)

Cada dev precisa rodar os passos de clone + symlinks após clonar o projeto.

**Windows (PowerShell):** Após clone + repos, rodar:
```powershell
& .copilot-core\.internal\config\setup-instructions.ps1
```

**Linux/Mac (Bash):** Criar symlinks manualmente (ver seção Bash acima).

## Clonando em nova máquina (Modo Aberto)

```bash
# Opção 1: Clone recursivo (recomendado — traz submodules)
git clone --recursive https://github.com/seu/projeto.git
cd projeto

# Opção 2: Clone normal + inicializar submodules
git clone https://github.com/seu/projeto.git
cd projeto
git submodule update --init --recursive
```

---

## Notas

- Symlinks usam nomes `agent-skills-*` para evitar conflitos com outros instruction files
- A estrutura final é idêntica em ambos os modos (aberto e stealth)
- O `.copilot-project` deve ter a branch correta do projeto antes de criar symlinks
- **Windows**: O script `setup-instructions.ps1` automatiza criação de symlinks (cria dir, remove antigos, cria novos, valida)
- **Linux/Mac**: Symlinks são criados manualmente via `ln -s` (não há script bash equivalente)
