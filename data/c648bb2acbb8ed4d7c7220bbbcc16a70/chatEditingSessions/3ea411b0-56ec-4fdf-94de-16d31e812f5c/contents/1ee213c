---
name: code-powershell-write
description: Padr√µes e templates para scripts PowerShell (.ps1). Use ao criar ou editar arquivos *.ps1, quando pedir script PowerShell, ou ao verificar conformidade de scripts existentes. Triggers: arquivos .ps1, "criar script powershell", "script windows", "script ps1".
metadata:
  author: copilot-core
  version: "1.0"
  category: code
  delegable: full
---

# PowerShell Script Skill

Padr√µes para cria√ß√£o e edi√ß√£o de scripts PowerShell.

## Quando Usar

- Criar/editar arquivos `*.ps1`
- Pedido para criar script PowerShell
- Verificar conformidade de scripts existentes

## Workflow

### 1. Validar estrutura

**Se arquivo novo:**
‚Üí Aplicar template base completo

**Se arquivo existente:**
‚Üí Preservar estrutura e estilo
‚Üí Identificar padr√µes j√° utilizados

### 2. Verificar bloco param

**Se script aceita par√¢metros:**
‚Üí Garantir bloco `param()` no topo com tipos adequados

### 3. Verificar fun√ß√µes helper

Garantir fun√ß√µes de output:

```powershell
function Write-Step    { param([string]$Message) Write-Host "üöÄ $Message" -ForegroundColor White }
function Write-Info    { param([string]$Message) Write-Host "üîç $Message" -ForegroundColor Cyan }
function Write-Success { param([string]$Message) Write-Host "‚úÖ $Message" -ForegroundColor Green }
function Write-Warning { param([string]$Message) Write-Host "‚ö†Ô∏è $Message" -ForegroundColor Yellow }
function Write-Error   { param([string]$Message) Write-Host "‚ùå $Message" -ForegroundColor Red }
```

### 4. Aplicar idempot√™ncia

- Antes de instalar/criar, verificar se j√° existe
- Usar `Get-Command` para verificar comandos
- Usar `Test-Path` para verificar paths

### 5. Garantir tratamento de erros

Envolver opera√ß√µes cr√≠ticas em try/catch:

```powershell
try {
    # opera√ß√£o
} catch {
    Write-Error "Failed: $_"
    exit 1
}
```

## Template Base

```powershell
# ============================================================================
# Script: {Nome-Do-Script}.ps1
# Description: {descri√ß√£o breve}
# ============================================================================

param(
    [string]$Param1,
    [switch]$Force
)

# ============================================================================
# Helper Functions
# ============================================================================

function Test-Administrator {
    $identity = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = [Security.Principal.WindowsPrincipal]$identity
    $principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
}

function Write-Step    { param([string]$Message) Write-Host "üöÄ $Message" -ForegroundColor White }
function Write-Info    { param([string]$Message) Write-Host "üîç $Message" -ForegroundColor Cyan }
function Write-Success { param([string]$Message) Write-Host "‚úÖ $Message" -ForegroundColor Green }
function Write-Warning { param([string]$Message) Write-Host "‚ö†Ô∏è $Message" -ForegroundColor Yellow }
function Write-Error   { param([string]$Message) Write-Host "‚ùå $Message" -ForegroundColor Red }

# ============================================================================
# Main Functions
# ============================================================================

function Test-Prerequisites {
    Write-Info "Checking prerequisites..."
    # if (-not (Get-Command docker -ErrorAction SilentlyContinue)) {
    #     Write-Error "Docker not found"
    #     exit 1
    # }
}

function Main {
    Write-Step "Starting {Nome-Do-Script}..."
    
    Test-Prerequisites
    
    # Main logic here
    
    Write-Success "Done!"
}

# ============================================================================
# Entry Point
# ============================================================================

Main
```

## Conven√ß√µes

| Tipo | Padr√£o | Exemplo |
|------|--------|---------|
| Nome arquivo | `Verbo-Substantivo.ps1` | `Install-Docker.ps1` |
| Fun√ß√µes | `Verb-Noun` | `Test-Administrator` |
| Vari√°veis | `$PascalCase` | `$UserProfile` |
| Par√¢metros | `$PascalCase` | `$Force`, `$Path` |

## Checklist

- [ ] Bloco param() se aceita par√¢metros
- [ ] Fun√ß√µes helper de output
- [ ] Idempotente (verifica estado antes)
- [ ] try/catch em opera√ß√µes cr√≠ticas
- [ ] Feedback de progresso
- [ ] Sem paths absolutos hardcoded
