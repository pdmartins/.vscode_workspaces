---
name: code-pattern-enforce
description: Verifica e aplica padr√µes de c√≥digo definidos no projeto (naming, estrutura, conven√ß√µes). Autom√°tico ap√≥s gerar c√≥digo. L√™ config.yml do project para regras. Triggers: "verificar padr√µes", "est√° no padr√£o?", "padronizar", "conven√ß√µes", automaticamente ap√≥s gerar c√≥digo, durante code review.
metadata:
  author: copilot-core
  version: "1.0"
  category: code
  delegable: orchestrated
---

# Code Pattern Enforce

Verifica e aplica padr√µes de c√≥digo definidos no projeto.

## Quando Usar

- **Automaticamente** ap√≥s gerar qualquer c√≥digo novo
- Durante code review (`code-review-analyze`)
- Usu√°rio pergunta "est√° no padr√£o?"
- Ao padronizar c√≥digo existente

## Config Loading

1. Verificar se existe `{workspace}/.copilot-project/skills/code-pattern-enforce/config.yml`
2. Se existe, carregar regras do projeto
3. Verificar se existe `{workspace}/.copilot-project/skills/code-pattern-enforce/SKILL.md`
4. Se existe, carregar regras complementares (conven√ß√µes densas e espec√≠ficas)
5. Se nenhum existe, usar padr√µes gen√©ricos

## Workflow

### 1. Identificar c√≥digo a verificar

- C√≥digo rec√©m-gerado pelo agente
- Arquivo espec√≠fico indicado pelo usu√°rio
- Changeset de um PR

### 2. Carregar regras do projeto

Ler `config.yml` para obter as regras de:
- Naming conventions
- Estrutura de arquivos/pastas
- Padr√µes obrigat√≥rios
- Anti-patterns proibidos

### 3. Verificar conformidade

Para cada regra, verificar se o c√≥digo est√° em conformidade:

| Categoria | Verifica√ß√µes |
|-----------|-------------|
| **Naming** | Classes, m√©todos, vari√°veis, arquivos seguem padr√£o |
| **Estrutura** | Arquivo no diret√≥rio correto, namespace correto |
| **Patterns** | DI registration, error handling, logging |
| **Anti-patterns** | C√≥digo proibido, pr√°ticas banidas |
| **Style** | Async suffix, null guards, CancellationToken |

### 4. Reportar

```
‚úÖ **Padr√µes verificados** ‚Äî X regras, Y conformes, Z viola√ß√µes

üü† Viola√ß√µes:
- [regra] Descri√ß√£o ‚Üí Corre√ß√£o sugerida
- [regra] Descri√ß√£o ‚Üí Corre√ß√£o sugerida
```

### 5. Corrigir automaticamente

Se poss√≠vel, corrigir viola√ß√µes encontradas diretamente (com confirma√ß√£o do usu√°rio).

## Regras Gen√©ricas

### Naming

| Artefato | Padr√£o |
|----------|--------|
| Classes | PascalCase |
| Interfaces | `I` + PascalCase |
| M√©todos | PascalCase |
| Vari√°veis locais | camelCase |
| Constantes | UPPER_SNAKE_CASE ou PascalCase |
| Arquivos | Mesmo nome da classe principal |

### Estrutura

| Regra | Descri√ß√£o |
|-------|-----------|
| Um arquivo por classe/interface | Separa√ß√£o clara |
| Namespace = caminho de diret√≥rios | Consist√™ncia |
| Testes espelham estrutura do source | F√°cil localiza√ß√£o |

### Patterns Obrigat√≥rios

| Pattern | Quando |
|---------|--------|
| Null guard | Par√¢metros de construtor |
| CancellationToken | M√©todos async |
| IOptions\<T> | Configura√ß√µes |
| ILogger\<T> | Logging estruturado |
| Interface-first | Antes da implementa√ß√£o |

### Anti-Patterns

| Proibido | Alternativa |
|----------|-------------|
| `string.Format` para SQL values | Par√¢metros tipados |
| `catch (Exception) { }` silencioso | Log m√≠nimo |
| `new HttpClient()` direto | `IHttpClientFactory` |
| Secrets em c√≥digo | Configuration/KeyVault |
| DateTime.Now | DateTime.UtcNow ou `IDateTimeProvider` |

## Checklist

- [ ] Naming segue conven√ß√µes
- [ ] Arquivos no diret√≥rio correto
- [ ] Namespace corresponde ao path
- [ ] Patterns obrigat√≥rios aplicados
- [ ] Nenhum anti-pattern presente
- [ ] DI registration com lifetime correto

## Config Schema

```yaml
# .copilot-project/skills/code-pattern-enforce/config.yml
naming:
  classes: PascalCase
  interfaces: "I{PascalCase}"
  methods: PascalCase
  variables: camelCase
  constants: PascalCase               # or UPPER_SNAKE_CASE
  files: "{ClassName}.cs"
  namespace: "{Project}.{Layer}.{Feature}.v1"
structure:
  contracts: "Contracts/v1/"
  services: "Services/v1/"
  models: "Models/v1/"
  wrappers: "Wrappers/v1/"
  tests: "{Project}.UnitTests/"
required-patterns:
  - null-guard
  - cancellation-token
  - ioptions
  - ilogger
  - interface-first
anti-patterns:
  - sql-string-concat
  - silent-catch
  - direct-httpclient
  - hardcoded-secrets
  - datetime-now
custom-rules:
  - name: "Versioned folders"
    description: "All feature folders must have v1/ subfolder"
    applies-to: [Domain, Infrastructure]
  - name: "Bootstrapper registration"
    description: "All services must be registered in Bootstrapper.cs"
    applies-to: [Services]
```
