---
name: project-codemap-update
description: Registra e atualiza o mapa de c√≥digo do projeto ap√≥s criar, alterar ou remover classes, m√©todos, fun√ß√µes, endpoints, modelos ou utilit√°rios. Acionado AUTOMATICAMENTE ap√≥s qualquer cria√ß√£o ou altera√ß√£o de c√≥digo. Triggers: ap√≥s criar classe, m√©todo, fun√ß√£o, endpoint, modelo, componente, servi√ßo, helper, utilit√°rio, hook, middleware, ap√≥s refatorar, ap√≥s mover/renomear.
metadata:
  author: copilot-core
  version: "1.0"
  category: project
  delegable: full
---

# Project Codemap Update

Registra e atualiza o mapa estruturado de c√≥digo do projeto para evitar duplica√ß√£o e maximizar reaproveitamento.

## Quando Usar

- **Automaticamente** ap√≥s criar qualquer artefato de c√≥digo (classe, m√©todo, fun√ß√£o, etc.)
- **Automaticamente** ap√≥s alterar assinatura, responsabilidade ou localiza√ß√£o de artefato existente
- **Automaticamente** ap√≥s remover/deprecar artefato
- Ao refatorar c√≥digo (mover, renomear, dividir, unificar)

## Quando N√ÉO Usar

- Altera√ß√µes internas que n√£o mudam a interface p√∫blica (body de m√©todo sem mudar assinatura)
- Altera√ß√µes em arquivos de configura√ß√£o (usar `project-context-update`)
- Corre√ß√£o de bugs que n√£o altera a estrutura

## Estrutura do Code Map

O mapa de c√≥digo fica em `{workspace}/.copilot-project/context/code-map/` com os seguintes arquivos:

```
code-map/
‚îú‚îÄ‚îÄ index.md        # √çndice mestre ‚Äî vis√£o geral da arquitetura
‚îú‚îÄ‚îÄ services.md     # Servi√ßos e l√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ models.md       # Modelos, entidades, DTOs, interfaces de dados
‚îú‚îÄ‚îÄ api.md          # Endpoints, controllers, rotas
‚îú‚îÄ‚îÄ components.md   # Componentes de UI (se aplic√°vel)
‚îú‚îÄ‚îÄ utils.md        # Utilit√°rios, helpers, fun√ß√µes auxiliares
‚îî‚îÄ‚îÄ config.md       # Constantes, enums, configura√ß√µes em c√≥digo
```

> **Nota**: Nem todos os arquivos precisam existir. Criar apenas os que o projeto necessita.

## Formato dos Registros

### index.md ‚Äî √çndice Mestre

```markdown
# Code Map

> Atualizado em: {YYYY-MM-DD}

## Arquitetura

{Descri√ß√£o breve de 2-3 linhas da arquitetura geral}

## M√≥dulos

| M√≥dulo | Arquivo do Mapa | Descri√ß√£o | Artefatos |
|--------|-----------------|-----------|-----------|
| Services | [services.md](services.md) | L√≥gica de neg√≥cio | {count} |
| Models | [models.md](models.md) | Modelos de dados | {count} |
| API | [api.md](api.md) | Endpoints | {count} |
| Utils | [utils.md](utils.md) | Utilit√°rios | {count} |

## Depend√™ncias entre M√≥dulos

{Breve descri√ß√£o de como os m√≥dulos se conectam}
```

### Arquivos de detalhe (services.md, models.md, etc.)

Cada artefato usa o seguinte template:

```markdown
## {NomeDoArtefato}

- **Arquivo**: `{caminho/relativo/ao/projeto}`
- **Tipo**: {class | function | interface | enum | component | hook | middleware}
- **Responsabilidade**: {uma linha descrevendo o que faz}
- **Depende de**: `{ArtefatoA}`, `{ArtefatoB}` (ou "nenhum")

| M√©todo/Export | Par√¢metros | Retorno | Descri√ß√£o |
|---------------|-----------|---------|-----------|
| `metodo1` | `(param: Type)` | `ReturnType` | O que faz |
| `metodo2` | `(a: A, b: B)` | `void` | O que faz |

---
```

### Regras do formato

1. **Manter simples** ‚Äî apenas interface p√∫blica (m√©todos p√∫blicos, exports)
2. **N√£o duplicar c√≥digo** ‚Äî registrar assinatura, n√£o implementa√ß√£o
3. **Separador** `---` entre cada artefato para facilitar parsing
4. **Depende de** ‚Äî listar apenas depend√™ncias internas do projeto, n√£o de bibliotecas externas

## Workflow

### 1. Identificar tipo de opera√ß√£o

| Opera√ß√£o | A√ß√£o no Code Map |
|----------|-----------------|
| Criar artefato novo | Adicionar entrada no arquivo correto |
| Alterar assinatura/responsabilidade | Atualizar entrada existente |
| Mover para outro arquivo | Atualizar campo "Arquivo" |
| Renomear | Atualizar nome e refer√™ncias em "Depende de" de outros artefatos |
| Remover | Remover entrada e limpar refer√™ncias |
| Adicionar m√©todo a classe existente | Adicionar linha na tabela de m√©todos |

### 2. Determinar arquivo destino

| Tipo de Artefato | Arquivo |
|-----------------|---------|
| Service, Repository, Provider, Manager | `services.md` |
| Model, Entity, DTO, Interface de dados, Schema | `models.md` |
| Controller, Route, Endpoint, Resolver | `api.md` |
| Component, Page, Layout, Widget | `components.md` |
| Helper, Util, Formatter, Validator, Guard | `utils.md` |
| Enum, Constants, Config em c√≥digo | `config.md` |

### 3. Aplicar atualiza√ß√£o

1. Ler o arquivo de destino em `{workspace}/.copilot-project/context/code-map/`
2. Se arquivo n√£o existe ‚Üí criar com header padr√£o (se o diret√≥rio `code-map/` tamb√©m n√£o existe, executar Auto-Init abaixo primeiro)
3. Adicionar/atualizar/remover o registro
4. Atualizar `index.md` (contagem de artefatos e descri√ß√£o se necess√°rio)

### 4. Confirmar registro

**Output**:
```
üó∫Ô∏è **Code Map atualizado**: {opera√ß√£o} `{NomeDoArtefato}` em `{arquivo}.md`
```

## Exemplos

### Novo servi√ßo criado

```markdown
## UserService

- **Arquivo**: `src/services/user.service.ts`
- **Tipo**: class
- **Responsabilidade**: Gerenciamento de CRUD de usu√°rios
- **Depende de**: `UserRepository`, `CreateUserDto`

| M√©todo/Export | Par√¢metros | Retorno | Descri√ß√£o |
|---------------|-----------|---------|-----------|
| `create` | `(dto: CreateUserDto)` | `Promise<User>` | Cria novo usu√°rio |
| `findById` | `(id: string)` | `Promise<User \| null>` | Busca por ID |
| `update` | `(id: string, dto: UpdateUserDto)` | `Promise<User>` | Atualiza usu√°rio |
| `delete` | `(id: string)` | `Promise<void>` | Remove usu√°rio |

---
```

### Nova fun√ß√£o utilit√°ria

```markdown
## formatCurrency

- **Arquivo**: `src/utils/formatters.ts`
- **Tipo**: function
- **Responsabilidade**: Formata valor num√©rico para moeda BRL
- **Depende de**: nenhum

| M√©todo/Export | Par√¢metros | Retorno | Descri√ß√£o |
|---------------|-----------|---------|-----------|
| `formatCurrency` | `(value: number, locale?: string)` | `string` | Formata para R$ X.XXX,XX |

---
```

## Auto-Init

Quando `code-map/` n√£o existir, criar automaticamente:

1. Criar diret√≥rio: `{workspace}/.copilot-project/context/code-map/`
2. Criar `index.md` com template padr√£o (ver `project-codemap-query` para o template completo)
3. Prosseguir com o registro normalmente
