# Project Context â€” Copilot Core

Estado atual do projeto para referÃªncia do Copilot.

---

## Objetivo

Sistema de instruÃ§Ãµes e skills reutilizÃ¡veis para o Copilot Agent, seguindo o padrÃ£o [Agent Skills](https://agentskills.io). Fornece um core genÃ©rico (`.copilot-core`) que Ã© plugado via git submodule ou clone na **raiz** de qualquer projeto, junto com um repositÃ³rio de dados por projeto (`.copilot-project`) com branch por projeto. Suporta dois modos de instalaÃ§Ã£o: **aberto** (submodule visÃ­vel) e **stealth** (clone + gitignore, invisÃ­vel).

## Repos

| Repo | URL | PropÃ³sito |
|------|-----|-----------|
| `.copilot-core` | `https://github.com/pdmartins/.copilot-core.git` | Skills genÃ©ricos, instruÃ§Ãµes globais, templates |
| `.copilot-project` | `https://github.com/pdmartins/.copilot-project.git` | Contexto, memÃ³ria e skills especÃ­ficos por projeto (branch por projeto) |

## Stack

| Componente | Tecnologia |
|------------|------------|
| Formato | Markdown (Agent Skills pattern) |
| Versionamento | Git (submodules ou clones para distribuiÃ§Ã£o) |
| CI/CD | GitHub Actions (`sync-core.yml`) |
| PadrÃ£o | [Agent Skills](https://agentskills.io) |
| Commit | Conventional Commits |
| Linting | markdownlint (via extensÃ£o VS Code) |

## Arquitetura

**Workspace de desenvolvimento** com dois repos lado a lado, gerenciados pelo `.copilot-core.code-workspace`:

```
copilot/                          # Pasta raiz do workspace
â”œâ”€â”€ .copilot-core/                # Repo principal (branch main)
â”‚   â”œâ”€â”€ .github/                  # "workspace" â€” NÃƒO distribuÃ­do (excluÃ­do pelo sync-core.yml)
â”‚   â”‚   â”œâ”€â”€ context/              # â† Contexto deste projeto (self-dogfooding)
â”‚   â”‚   â”‚   â””â”€â”€ project.md
â”‚   â”‚   â”œâ”€â”€ memory/               # â† MemÃ³ria deste projeto (self-dogfooding)
â”‚   â”‚   â”‚   â””â”€â”€ lessons-learned.md
â”‚   â”‚   â”œâ”€â”€ docs/
â”‚   â”‚   â”‚   â””â”€â”€ QUICK-START.md
â”‚   â”‚   â”œâ”€â”€ instructions/
â”‚   â”‚   â”‚   â””â”€â”€ workspace.instructions.md
â”‚   â”‚   â””â”€â”€ workflows/
â”‚   â”‚       â””â”€â”€ sync-core.yml
â”‚   â”œâ”€â”€ .source-control/
â”‚   â”‚   â””â”€â”€ commit-prompt.md
â”‚   â”œâ”€â”€ instructions/             # "core" â€” DistribuÃ­do via branch core
â”‚   â”‚   â””â”€â”€ default.instructions.md
â”‚   â”œâ”€â”€ skills/                   # "core" â€” DistribuÃ­do via branch core
â”‚   â”‚   â”œâ”€â”€ agent/                # Skills organizados por tipo
â”‚   â”‚   â”œâ”€â”€ code/
â”‚   â”‚   â”œâ”€â”€ editor/
â”‚   â”‚   â”œâ”€â”€ infra/
â”‚   â”‚   â”œâ”€â”€ lang/
â”‚   â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â””â”€â”€ skill/
â”‚   â”‚       â””â”€â”€ {skill-name}/SKILL.md
â”‚   â””â”€â”€ templates/                # "core" â€” DistribuÃ­do via branch core
â”‚       â””â”€â”€ workspace.instructions.md
â”‚
â”œâ”€â”€ .copilot-project/             # Repo auxiliar â€” branch principal: main (template)
â”‚   â”œâ”€â”€ context/
â”‚   â”œâ”€â”€ memory/
â”‚   â””â”€â”€ skills/
â”‚
â”œâ”€â”€ .copilot-project-worktrees/   # Worktrees do .copilot-project (nomes = branches)
â”‚   â”œâ”€â”€ _bw/bewiser.assistant.api/
â”‚   â”œâ”€â”€ _hv/STT/
â”‚   â”œâ”€â”€ docker-framework/
â”‚   â””â”€â”€ scripts/
â”‚
â””â”€â”€ .github â†’ .copilot-core/.github  # Junction link para self-dogfooding
```

### EstratÃ©gia de Branches

#### `.copilot-core`

| Branch | PropÃ³sito | ConteÃºdo |
|--------|-----------|----------|
| `main` | Desenvolvimento do core | Tudo (`.github/`, `.source-control/`, workspace file) |
| `core` | DistribuiÃ§Ã£o para projetos | Apenas `instructions/`, `skills/`, `templates/` |

O workflow `sync-core.yml` sincroniza `main` â†’ `core` automaticamente ao push, excluindo `.github/`.

#### `.copilot-project`

| Branch | PropÃ³sito |
|--------|-----------|
| `main` | Template base agnÃ³stico |
| `{nome-projeto}` | Dados especÃ­ficos de cada projeto |

### Projetos Consumidores

Nos projetos-alvo, a estrutura final Ã©:

```
{projeto}/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ instructions/
â”‚       â”œâ”€â”€ default.instructions.md      â†’ symlink â†’ ../../.copilot-core/instructions/default.instructions.md
â”‚       â””â”€â”€ workspace.instructions.md    â†’ symlink â†’ ../../.copilot-project/instructions/workspace.instructions.md
â”‚
â”œâ”€â”€ .copilot-core/                  # Submodule ou clone (branch core)
â””â”€â”€ .copilot-project/               # Submodule ou clone (branch do projeto)
    â””â”€â”€ instructions/
        â””â”€â”€ workspace.instructions.md   # Arquivo real especÃ­fico do projeto
```

**Modo aberto** (submodule): visÃ­vel no `.gitmodules`, onboarding via `git clone --recursive`.
**Modo stealth** (clone): `.copilot-core/`, `.copilot-project/` e symlinks no `.gitignore`, onboarding via script manual.

Os arquivos em `.github/instructions/` sÃ£o **symlinks**, nunca cÃ³pias. Isso garante sincronizaÃ§Ã£o automÃ¡tica com os repos de origem.

## Skills Core (26)

| Tipo | Skill | VersÃ£o | PropÃ³sito |
|------|-------|--------|-----------|
| agent | `agent-memory-query` | 2.0 | Consultar liÃ§Ãµes aprendidas (com auto-init) |
| agent | `agent-memory-register` | 2.0 | Registrar novas liÃ§Ãµes (com auto-init) |
| agent | `agent-task-manage` | 1.0 | Gerenciar tarefas complexas |
| code | `code-review-analyze` | 1.0 | AnÃ¡lise de qualidade, seguranÃ§a e performance |
| code | `code-refactor-extract` | 1.0 | ExtraÃ§Ã£o de mÃ©todos/classes, SRP |
| code | `code-pattern-enforce` | 1.0 | VerificaÃ§Ã£o e enforcement de padrÃµes |
| project | `project-context-query` | 2.0 | Consultar contexto do projeto (com auto-init) |
| project | `project-context-update` | 2.0 | Atualizar contexto (com auto-init) |
| project | `project-codemap-query` | 2.0 | Consultar mapa de cÃ³digo (com auto-init) |
| project | `project-codemap-update` | 2.0 | Registrar/atualizar artefatos (com auto-init) |
| project | `project-structure-analyze` | 1.0 | Analisar projeto e sugerir skills |
| project | `project-workspace-create` | 3.0 | Criar projeto completo (Plan mode) |
| project | `project-setup-bootstrap` | 5.0 | Configurar projeto (automÃ¡tico + manual) |
| project | `project-repo-update` | 1.0 | Atualizar repos core e project |
| project | `project-branch-switch` | 1.0 | Trocar branch do .copilot-project |
| skill | `skill-template-create` | 2.0 | Criar novos skills |
| editor | `editor-markdown-lint` | 1.0 | Regras de formataÃ§Ã£o Markdown |
| lang | `lang-dotnet-service` | 1.0 | GeraÃ§Ã£o de serviÃ§os/handlers .NET |
| lang | `lang-dotnet-test` | 1.0 | GeraÃ§Ã£o de testes unitÃ¡rios .NET |
| infra | `infra-docker-build` | 1.0 | GeraÃ§Ã£o de Dockerfile multi-stage |
| infra | `infra-redis-cache` | 1.0 | PadrÃ£o cache-aside com Redis |
| infra | `infra-bigquery-query` | 1.0 | Queries BigQuery parametrizadas |
| infra | `infra-gcp-integrate` | 1.0 | IntegraÃ§Ã£o com serviÃ§os GCP |
| infra | `infra-k8s-deploy` | 1.0 | Manifests Kubernetes |
| infra | `infra-pipeline-deploy` | 1.0 | Pipelines CI/CD |
| infra | `infra-vertexai-prompt` | 1.0 | GestÃ£o de prompts Vertex AI |

### PadrÃµes dos Skills

- **Naming**: `{tipo}-{feature}-{aÃ§Ã£o}` â€” sempre 3 segmentos, kebab-case
- **Tipos**: `agent`, `code`, `project`, `skill`, `editor`, `lang`, `infra`
- **category = tipo**: Primeiro segmento do nome no frontmatter
- **Estrutura**: `skills/{tipo}/{name}/SKILL.md` (organizados em subpastas por tipo)
- **Config pattern**: Skills `lang`, `infra` e `code` carregam `config.yml` do project
- **Frontmatter**: YAML com `name`, `description`, `metadata` (`author`, `version`, `category`)
- **SeÃ§Ãµes**: `## Quando Usar` â†’ `## Workflow` com steps numerados
- **Output**: ConfirmaÃ§Ãµes com emojis (`âœ…`, `ğŸ“`, `ğŸ“š`, `ğŸ”„`, `ğŸ—ºï¸`, `ğŸ“‹`)
- **Auto-Init**: Skills de query/update inicializam estrutura automaticamente se nÃ£o existe
- **Core = lÃ³gica**: Regras genÃ©ricas ficam no core
- **Project = config**: Dados especÃ­ficos ficam em `config.yml` no project

## ConvenÃ§Ãµes

1. **Self-dogfooding**: O `.copilot-core` usa seu prÃ³prio sistema de memÃ³ria e contexto para governar seu desenvolvimento, excepcionalmente dentro de `.copilot-core/.github/`
2. **Junction link**: No workspace de desenvolvimento, `.github` na raiz aponta para `.copilot-core/.github/` via junction
3. **PortuguÃªs para chat, inglÃªs para cÃ³digo**: VariÃ¡veis, nomes de arquivo, paths em inglÃªs
4. **Core Ã© genÃ©rico**: Nunca referenciar projetos especÃ­ficos nos skills core
5. **Responsabilidade Ãºnica**: Cada skill faz UMA coisa
6. **Conventional Commits**: `<type>(<scope>): <description>` (single-line, â‰¤250 chars)
7. **Instructions via symlink**: Arquivos em `.github/instructions/` sÃ£o sempre symlinks, nunca cÃ³pias. `default.instructions.md` aponta para `../../.copilot-core/instructions/`, `workspace.instructions.md` aponta para `../../.copilot-project/instructions/`
8. **Workspace â‰  Core**: "no workspace" = `.copilot-core/.github/` (nÃ£o distribuÃ­do), "no core" = `.copilot-core/` (distribuÃ­do)
9. **Worktrees**: `.copilot-project` usa git worktrees em `.copilot-project-worktrees/` com nomes espelhando exatamente os nomes das branches

## Estado Atual

**Fase**: Ativo
**Status**: Core estÃ¡vel com 26 skills organizados em subpastas por tipo (nomenclatura `{tipo}-{feature}-{aÃ§Ã£o}`), sistema em uso em projetos reais. Suporte a dual-mode (aberto/stealth) para instalaÃ§Ã£o em projetos.

## Projetos Plugados

| Branch (.copilot-project) | Projeto | Status |
|---------------------------|---------|--------|
| `main` | Template base | â€” |
| `_hv/STT` | VoiceTranscription.AI (Hapvida) | Ativo |
| `scripts` | Scripts de automaÃ§Ã£o | Ativo |
| `docker-framework` | Docker Framework | â€” |

## InconsistÃªncias Conhecidas

| # | Issue | Local | Detalhe |
|---|-------|-------|---------|
| 1 | `project-repo-update` nota final incorreta | `skills/project-repo-update/SKILL.md` | Diz "Core usa branch `main`" â€” deveria ser `core` |
| 2 | URLs hardcoded | `project-workspace-create` | `github.com/pdmartins/` nÃ£o parametrizado |
| 3 | `references/`, `scripts/`, `assets/` nÃ£o usados | `workspace.instructions.md` loading flow | Documentado mas nenhum skill implementa |
| 4 | `project-repo-update` nota sobre `.gitignore` | `skills/project-repo-update/SKILL.md` | Submodules sÃ£o tracked por `.gitmodules`, nÃ£o por `.gitignore` |

## Ãšltima AtualizaÃ§Ã£o

**Data**: 2026-02-12
**Motivo**: MigraÃ§Ã£o de submodules para raiz do projeto (fora de .github/), skills organizados em subpastas por tipo, suporte a dual-mode (aberto/stealth)
