---
name: lang-controller-generate
description: Padrões para controllers ASP.NET Core com rotas RESTful. Use ao criar ou editar Controllers, definir rotas, implementar endpoints. Triggers: criar controller, novo endpoint, arquivos *Controller.cs, "API REST", rota.
metadata:
  author: copilot-project
  version: "2.0"
  category: lang
---

# ASP.NET Controller Skill

Padrões para criação de Controllers ASP.NET Core com rotas RESTful.

## Quando Usar

- Criar novo controller
- Adicionar endpoints a controller existente
- Implementar padrões REST
- Revisar estrutura de API

## Padrão RESTful

### Estrutura de Rotas

```
/api/{recursos}                    → Coleção
/api/{recursos}/{id}               → Recurso específico
/api/{recursos}/{id}/{subrecursos} → Sub-recursos
```

### Verbos HTTP e Semântica

| Verbo | Rota | Ação | Request | Response | Status |
|-------|------|------|---------|----------|--------|
| GET | `/api/assistants` | Listar | `ListAssistantsRequest` (query) | `ListAssistantsResponse` | 200 |
| GET | `/api/assistants/{id}` | Obter | - | `GetAssistantResponse` | 200/404 |
| POST | `/api/assistants` | Criar | `CreateAssistantRequest` | `CreateAssistantResponse` | 201 |
| PUT | `/api/assistants/{id}` | Atualizar | `UpdateAssistantRequest` | `UpdateAssistantResponse` | 200/404 |
| DELETE | `/api/assistants/{id}` | Remover | - | - | 204/404 |

### Regras RESTful

1. **Substantivos no plural** para recursos: `/api/assistants`, não `/api/assistant`
2. **Kebab-case** para rotas compostas: `/api/phone-numbers`, não `/api/phoneNumbers`
3. **IDs na rota** para recursos específicos: `/api/assistants/{id}`
4. **Query params** para filtros: `/api/assistants?name=test&page=1`
5. **Sem verbos na rota**: `/api/assistants`, não `/api/getAssistants`
6. **Sub-recursos** para relacionamentos: `/api/assistants/{id}/conversations`

## Template de Controller

```csharp
using Bewiser.Assistant.Api.Contracts.Requests;
using Bewiser.Assistant.Api.Contracts.Responses;
using Microsoft.AspNetCore.Mvc;

namespace Bewiser.Assistant.Api.Controllers;

/// <summary>
/// Manages {recurso} resources.
/// </summary>
[ApiController]
[Route("api/[controller]")]
[Produces("application/json")]
public class {Recursos}Controller : ControllerBase
{
    private readonly I{Recurso}Service _{recurso}Service;
    private readonly ILogger<{Recursos}Controller> _logger;

    public {Recursos}Controller(
        I{Recurso}Service {recurso}Service,
        ILogger<{Recursos}Controller> logger)
    {
        _{recurso}Service = {recurso}Service;
        _logger = logger;
    }

    /// <summary>
    /// Lists all {recursos} with pagination.
    /// </summary>
    [HttpGet]
    [ProducesResponseType(typeof(List{Recursos}Response), StatusCodes.Status200OK)]
    public async Task<ActionResult<List{Recursos}Response>> List(
        [FromQuery] List{Recursos}Request request,
        CancellationToken cancellationToken = default)
    {
        var response = await _{recurso}Service.ListAsync(request, cancellationToken);
        return Ok(response);
    }

    /// <summary>
    /// Gets a {recurso} by ID.
    /// </summary>
    [HttpGet("{id:guid}")]
    [ProducesResponseType(typeof(Get{Recurso}Response), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<ActionResult<Get{Recurso}Response>> GetById(
        Guid id,
        CancellationToken cancellationToken = default)
    {
        var response = await _{recurso}Service.GetByIdAsync(id, cancellationToken);
        
        if (response is null)
            return NotFound();
            
        return Ok(response);
    }

    /// <summary>
    /// Creates a new {recurso}.
    /// </summary>
    [HttpPost]
    [ProducesResponseType(typeof(Create{Recurso}Response), StatusCodes.Status201Created)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task<ActionResult<Create{Recurso}Response>> Create(
        [FromBody] Create{Recurso}Request request,
        CancellationToken cancellationToken = default)
    {
        var response = await _{recurso}Service.CreateAsync(request, cancellationToken);
        return CreatedAtAction(nameof(GetById), new { id = response.Id }, response);
    }

    /// <summary>
    /// Updates a {recurso}.
    /// </summary>
    [HttpPut("{id:guid}")]
    [ProducesResponseType(typeof(Update{Recurso}Response), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<ActionResult<Update{Recurso}Response>> Update(
        Guid id,
        [FromBody] Update{Recurso}Request request,
        CancellationToken cancellationToken = default)
    {
        var response = await _{recurso}Service.UpdateAsync(id, request, cancellationToken);
        
        if (response is null)
            return NotFound();
            
        return Ok(response);
    }

    /// <summary>
    /// Deletes a {recurso}.
    /// </summary>
    [HttpDelete("{id:guid}")]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<IActionResult> Delete(
        Guid id,
        CancellationToken cancellationToken = default)
    {
        var deleted = await _{recurso}Service.DeleteAsync(id, cancellationToken);
        
        if (!deleted)
            return NotFound();
            
        return NoContent();
    }
}
```

## Sub-recursos

Para relacionamentos, criar endpoints aninhados:

```csharp
/// <summary>
/// Lists conversations for an assistant.
/// </summary>
[HttpGet("{assistantId:guid}/conversations")]
[ProducesResponseType(typeof(ListConversationsResponse), StatusCodes.Status200OK)]
[ProducesResponseType(StatusCodes.Status404NotFound)]
public async Task<ActionResult<ListConversationsResponse>> ListConversations(
    Guid assistantId,
    [FromQuery] ListConversationsRequest request,
    CancellationToken cancellationToken = default)
{
    var response = await _conversationService.ListByAssistantAsync(
        assistantId, request, cancellationToken);
    return Ok(response);
}
```

## Status Codes

| Código | Significado | Quando Usar |
|--------|-------------|-------------|
| 200 OK | Sucesso | GET, PUT com body de resposta |
| 201 Created | Criado | POST (com Location header) |
| 204 No Content | Sucesso sem body | DELETE |
| 400 Bad Request | Validação falhou | Dados inválidos |
| 401 Unauthorized | Não autenticado | Token ausente/inválido |
| 403 Forbidden | Sem permissão | Autenticado mas não autorizado |
| 404 Not Found | Não existe | Recurso não encontrado |
| 409 Conflict | Conflito | Duplicidade, estado inválido |
| 422 Unprocessable | Regra de negócio | Validação de domínio |

## Convenções

| Tipo | Padrão | Exemplo |
|------|--------|---------|
| Classe | `{Recursos}Controller` | `AssistantsController` |
| Rota base | `api/[controller]` | `/api/assistants` |
| IDs | GUID com constraint | `{id:guid}` |
| Plural | Sempre | `assistants`, `conversations` |

## Checklist de Aderência

- [ ] Nome do controller no plural
- [ ] Rota base: `api/[controller]`
- [ ] Verbos HTTP corretos (GET, POST, PUT, DELETE)
- [ ] Status codes apropriados
- [ ] Requests em `Contracts/Requests/`
- [ ] Responses em `Contracts/Responses/`
- [ ] Nomenclatura: `[Verbo][Domínio]Request/Response`
- [ ] Documentação XML para Swagger
- [ ] `ProducesResponseType` em cada action
- [ ] `CancellationToken` em métodos async
