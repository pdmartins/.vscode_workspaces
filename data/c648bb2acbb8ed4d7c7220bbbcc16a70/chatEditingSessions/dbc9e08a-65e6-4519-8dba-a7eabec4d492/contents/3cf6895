```skill
---
name: agent-git-guard
description: Controla permiss√µes de opera√ß√µes git (add, commit, push) por projeto. Carrega config.yml do projeto para determinar o que √© permitido. Toda opera√ß√£o git DEVE passar por esta skill antes de executar. Default = nenhuma opera√ß√£o permitida. Triggers - git add, git commit, git push, antes de qualquer comando git.
metadata:
  author: copilot-core
  version: "1.0"
  category: agent
  delegable: none
---

# Agent Git Guard

Intercepta toda opera√ß√£o git para verificar permiss√µes do projeto.

## Quando Usar

- **Sempre** ‚Äî antes de executar `git add`, `git commit` ou `git push`
- O agente N√ÉO deve rodar nenhum comando git sem consultar esta skill

## Config Loading

1. Verificar `{workspace}/.copilot-project/skills/agent-git-guard/config.yml`
2. Se existe ‚Üí carregar permiss√µes
3. Se n√£o existe ‚Üí **default: tudo bloqueado**

## Workflow

### 1. Identificar opera√ß√£o e repo-alvo

| Info | Como obter |
|------|-----------|
| Opera√ß√£o | `add`, `commit`, `push` |
| Repo | Path do diret√≥rio (ex: `.copilot-core`, `.copilot-project`, repo principal) |

### 2. Consultar config

Mapear o repo ao alias no config. Se repo n√£o est√° listado ‚Üí **bloqueado**.

### 3. Verificar permiss√£o

| Resultado | A√ß√£o |
|-----------|------|
| ‚úÖ Permitido | Executar a opera√ß√£o git |
| ‚ùå Bloqueado | **N√£o executar**. Informar o usu√°rio |

### 4. Output quando bloqueado

```
üö´ Git {opera√ß√£o} bloqueado para {repo}.
   Permiss√µes em: .copilot-project/skills/agent-git-guard/config.yml
   O usu√°rio pode revisar as altera√ß√µes no Source Control do VS Code.
```

## Config Schema

```yaml
# .copilot-project/skills/agent-git-guard/config.yml
repos:
  copilot-core:                    # alias livre
    path: .copilot-core            # path relativo ao workspace
    add: true
    commit: true
    push: true
    commit_message_prefix: ""      # opcional: prefixo para commits

  copilot-project:
    path: .copilot-project
    add: true
    commit: true
    push: true

  main:                            # repo principal do projeto
    path: .
    add: false
    commit: false
    push: false

# Default para repos n√£o listados
default:
  add: false
  commit: false
  push: false
```

## Notas

- `delegable: none` ‚Äî permiss√µes de git s√£o decis√£o do main agent, n√£o de subagents
- Default seguro: sem config = sem git. Projetos opt-in explicitamente
- Commit message pode ser controlada via `commit_message_prefix` no config
```
