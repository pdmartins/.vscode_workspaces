---
name: agent-memory-query
description: Consulta li√ß√µes aprendidas e decis√µes hist√≥ricas do projeto. Prioriza busca sem√¢ntica via MCP memory-service (se dispon√≠vel), com fallback para leitura direta do .md. Use no in√≠cio de tarefas complexas, quando o usu√°rio perguntar sobre decis√µes passadas, ou quando precisar evitar erros j√° documentados. Triggers: "li√ß√µes aprendidas", "decis√µes anteriores", "hist√≥rico do projeto", in√≠cio de implementa√ß√£o complexa.
metadata:
  author: copilot-core
  version: "2.0"
  category: agent
  delegable: full
---

# Agent Memory Query

Consulta a mem√≥ria persistente do projeto para recuperar li√ß√µes aprendidas e decis√µes hist√≥ricas. Prioriza busca sem√¢ntica via MCP quando dispon√≠vel.

## Quando Usar

- In√≠cio de tarefa complexa (consultar antes de implementar)
- Usu√°rio pergunta sobre decis√µes passadas
- Antes de tomar decis√£o arquitetural (verificar se j√° foi decidido)
- Quando padr√£o ou erro parece familiar

## Estrat√©gia de Busca

```
1. MCP memory-service dispon√≠vel?
   ‚îú‚îÄ‚îÄ SIM ‚Üí Busca sem√¢ntica h√≠brida (BM25 + vector) via mcp_memory_search_nodes
   ‚îÇ         Retorna resultados rankeados por relev√¢ncia
   ‚îî‚îÄ‚îÄ N√ÉO ‚Üí Fallback: leitura direta do .md + grep por keywords
```

> O MCP √© um √≠ndice derivado dos .md. Se os resultados parecerem desatualizados, chamar `agent-memory-sync` para reindexar.

## Workflow

### 1. Tentar busca via MCP (preferencial)

Se MCP memory-service estiver configurado (`.vscode/mcp.json`):

```
mcp_memory_search_nodes({
  query: "{termos de busca derivados da tarefa atual}"
})
```

Filtrar resultados por `entityType: "lesson"` e apresentar rankeados.

**Se MCP n√£o dispon√≠vel ou retornar vazio** ‚Üí passar para passo 2.

### 2. Fallback ‚Äî Leitura direta do .md

Ler: `{workspace}/.copilot-project/memory/lessons-learned.md`

**Se arquivo n√£o existe:**
‚Üí Criar automaticamente a estrutura de mem√≥ria (ver se√ß√£o "Auto-Init" abaixo)
‚Üí Informar usu√°rio que mem√≥ria foi inicializada
‚Üí Retornar que nenhuma li√ß√£o existe ainda

### 3. Identificar li√ß√µes relevantes

- Filtrar por categoria relacionada √† tarefa atual
- Priorizar li√ß√µes mais recentes
- Identificar padr√µes aplic√°veis

### 4. Apresentar ao usu√°rio

**Output**:
```
üìö **Li√ß√µes relevantes encontradas**:
- [categoria] descri√ß√£o da li√ß√£o
- [categoria] descri√ß√£o da li√ß√£o
```

**Se nenhuma li√ß√£o relevante:**
```
üìö Nenhuma li√ß√£o relevante encontrada para esta tarefa.
```

### 5. Aplicar conhecimento

- Usar informa√ß√µes para guiar implementa√ß√£o
- Evitar repetir erros documentados
- Seguir padr√µes j√° estabelecidos

## Categorias de Li√ß√µes

| Categoria | Descri√ß√£o |
|-----------|-----------|
| arquitetura | Estrutura do projeto, organiza√ß√£o |
| padr√µes | Conven√ß√µes de c√≥digo, nomenclatura |
| tooling | Ferramentas, depend√™ncias, configs |
| workflow | Processos, automa√ß√µes |
| debug | Problemas resolvidos, armadilhas |
| performance | Otimiza√ß√µes, melhorias |
| seguran√ßa | Pr√°ticas de seguran√ßa |
| regras | Defini√ß√µes e regras do sistema |
| estrutura | Organiza√ß√£o e estrutura de diret√≥rios |

## Auto-Init

Quando `memory/` ou `lessons-learned.md` n√£o existir, criar automaticamente:

1. Criar diret√≥rio: `{workspace}/.copilot-project/memory/`
2. Criar `lessons-learned.md` com template:

```markdown
# Lessons Learned

Registro de aprendizados e decis√µes importantes do projeto.

---

## Estrutura

Cada li√ß√£o segue o formato:

```xml
<lesson date="YYYY-MM-DD" category="categoria">
  <context>Contexto do problema</context>
  <decision>Decis√£o tomada</decision>
  <outcome>Resultado/impacto</outcome>
</lesson>
```

### Categorias

| Categoria | Descri√ß√£o |
|-----------|----------|
| arquitetura | Estrutura do projeto |
| padr√µes | Conven√ß√µes de c√≥digo |
| tooling | Ferramentas e configs |
| workflow | Processos |
| debug | Problemas resolvidos |
| performance | Otimiza√ß√µes |
| seguran√ßa | Pr√°ticas de seguran√ßa |
| regras | Defini√ß√µes e regras do sistema |
| estrutura | Organiza√ß√£o e estrutura de diret√≥rios |

---

## Registro

<!-- Adicionar li√ß√µes aqui, mais recente primeiro -->
```

3. Informar: `‚úÖ Mem√≥ria inicializada automaticamente`
