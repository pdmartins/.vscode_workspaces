{"version":2,"initialFileContents":[["file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","cd75f25"]],"timeline":{"checkpoints":[{"checkpointId":"61d624be-a6cc-475e-853e-6e596865a59f","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"4e70af00-e621-4d5a-b089-f6e7e432125b","requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","epoch":1,"label":"Request request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc"},{"checkpointId":"42bef616-f533-41fb-bb11-3fdeaa58c4e7","requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","undoStopId":"0047159d-eb47-41f2-abf6-5e6728ecc071","epoch":2,"label":"Request request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc - Stop 0047159d-eb47-41f2-abf6-5e6728ecc071"}],"currentEpoch":6,"fileBaselines":[["file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs::request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc",{"uri":{"$mid":1,"fsPath":"d:\\Repos\\_sk\\Sky.HubAI\\_others_src\\EmailComunicado\\scriptOutLook.vbs","_sep":1,"external":"file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","path":"/d:/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","scheme":"file"},"requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","content":"Option Explicit\r\n\r\n' =============================================================================\r\n' SCRIPT: Exportador de Notificacoes de Leitura/Entrega do Outlook\r\n' DESCRICAO: Processa ReportItems da Inbox, exporta para CSV e move para pasta\r\n' =============================================================================\r\n\r\n' ===== VARIAVEIS GLOBAIS =====\r\nDim g_olApp, g_olNamespace, g_olInbox, g_olDestinationFolder\r\nDim g_fso, g_csvFile\r\nDim g_emailRegex\r\nDim g_processedItems\r\n\r\n' ===== PARAMETROS DE CONFIGURACAO =====\r\nDim CFG_CSV_PATH\r\nDim CFG_DESTINATION_FOLDER\r\nDim CFG_CSV_DELIMITER\r\nDim CFG_CSV_HEADER\r\nDim CFG_EMAIL_REGEX_PATTERN\r\nDim CFG_INBOX_FOLDER_ID\r\nDim CFG_MSG_EMAIL_NOT_FOUND\r\nDim CFG_MSG_NO_BODY\r\nDim CFG_MSG_COMPLETION\r\n\r\n' Prefixos para identificacao de tipo Leitura\r\nDim CFG_READ_PREFIXES\r\n' Prefixos para identificacao de tipo Entrega\r\nDim CFG_DELIVERY_PREFIXES\r\n' Tipos de relatorio\r\nDim CFG_TYPE_READ\r\nDim CFG_TYPE_DELIVERY\r\nDim CFG_TYPE_OTHER\r\n\r\n' ===== INICIALIZACAO DE PARAMETROS =====\r\nSub InitializeParameters()\r\n    ' Caminho do arquivo CSV de saida\r\n    CFG_CSV_PATH = \"D:\\Automation Anywhere\\My Docs\\Testes\\notificacoes_leitura.csv\"\r\n    \r\n    ' Nome da pasta de destino no Outlook\r\n    CFG_DESTINATION_FOLDER = \"Processados\"\r\n    \r\n    ' Delimitador do CSV\r\n    CFG_CSV_DELIMITER = \";\"\r\n    \r\n    ' Cabecalho do CSV\r\n    CFG_CSV_HEADER = \"AssuntoOriginal;Tipo;Email;DataHora\"\r\n    \r\n    ' Expressao regular para extrair emails\r\n    CFG_EMAIL_REGEX_PATTERN = \"[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}\"\r\n    \r\n    ' ID da pasta Inbox no Outlook (6 = olFolderInbox)\r\n    CFG_INBOX_FOLDER_ID = 6\r\n    \r\n    ' Mensagens padrao\r\n    CFG_MSG_EMAIL_NOT_FOUND = \"(nao encontrado)\"\r\n    CFG_MSG_NO_BODY = \"(sem corpo)\"\r\n    CFG_MSG_COMPLETION = \"Exportacao concluida!\"\r\n    \r\n    ' Prefixos que identificam notificacao de Leitura (separados por |)\r\n    CFG_READ_PREFIXES = \"Read:|Lida:\"\r\n    \r\n    ' Prefixos que identificam notificacao de Entrega (separados por |)\r\n    CFG_DELIVERY_PREFIXES = \"Delivered:|Entregue:|Relayed:|Retransmitida:\"\r\n    \r\n    ' Nomes dos tipos de relatorio\r\n    CFG_TYPE_READ = \"Leitura\"\r\n    CFG_TYPE_DELIVERY = \"Entrega\"\r\n    CFG_TYPE_OTHER = \"Outro\"\r\nEnd Sub\r\n\r\n' ===== INICIALIZACAO DO OUTLOOK =====\r\nSub InitializeOutlook()\r\n    Set g_olApp = CreateObject(\"Outlook.Application\")\r\n    Set g_olNamespace = g_olApp.GetNamespace(\"MAPI\")\r\n    Set g_olInbox = g_olNamespace.GetDefaultFolder(CFG_INBOX_FOLDER_ID)\r\nEnd Sub\r\n\r\n' ===== INICIALIZACAO DO ARQUIVO CSV =====\r\nSub InitializeCsvFile()\r\n    Set g_fso = CreateObject(\"Scripting.FileSystemObject\")\r\n    Set g_csvFile = g_fso.CreateTextFile(CFG_CSV_PATH, True)\r\n    g_csvFile.WriteLine CFG_CSV_HEADER\r\nEnd Sub\r\n\r\n' ===== INICIALIZACAO DO REGEX PARA EMAILS =====\r\nSub InitializeEmailRegex()\r\n    Set g_emailRegex = New RegExp\r\n    g_emailRegex.Pattern = CFG_EMAIL_REGEX_PATTERN\r\n    g_emailRegex.Global = True\r\n    g_emailRegex.IgnoreCase = True\r\nEnd Sub\r\n\r\n' ===== OBTER OU CRIAR PASTA DE DESTINO =====\r\nSub GetOrCreateDestinationFolder()\r\n    Dim subFolder\r\n    Dim folderFound\r\n    \r\n    folderFound = False\r\n    \r\n    ' Procura a pasta de destino dentro da Inbox\r\n    For Each subFolder In g_olInbox.Folders\r\n        If LCase(subFolder.Name) = LCase(CFG_DESTINATION_FOLDER) Then\r\n            Set g_olDestinationFolder = subFolder\r\n            folderFound = True\r\n            Exit For\r\n        End If\r\n    Next\r\n    \r\n    ' Se nao encontrou, cria a pasta\r\n    If Not folderFound Then\r\n        Set g_olDestinationFolder = g_olInbox.Folders.Add(CFG_DESTINATION_FOLDER)\r\n    End If\r\nEnd Sub\r\n\r\n' ===== IDENTIFICAR TIPO E EXTRAIR ASSUNTO ORIGINAL =====\r\nFunction GetReportTypeAndSubject(subject, ByRef originalSubject)\r\n    Dim prefixes, prefix, pos\r\n    Dim reportType\r\n    \r\n    reportType = CFG_TYPE_OTHER\r\n    originalSubject = subject\r\n    \r\n    ' Verifica prefixos de Leitura\r\n    prefixes = Split(CFG_READ_PREFIXES, \"|\")\r\n    For Each prefix In prefixes\r\n        pos = InStr(1, subject, prefix, vbTextCompare)\r\n        If pos > 0 Then\r\n            reportType = CFG_TYPE_READ\r\n            originalSubject = Trim(Mid(subject, pos + Len(prefix)))\r\n            GetReportTypeAndSubject = reportType\r\n            Exit Function\r\n        End If\r\n    Next\r\n    \r\n    ' Verifica prefixos de Entrega\r\n    prefixes = Split(CFG_DELIVERY_PREFIXES, \"|\")\r\n    For Each prefix In prefixes\r\n        pos = InStr(1, subject, prefix, vbTextCompare)\r\n        If pos > 0 Then\r\n            reportType = CFG_TYPE_DELIVERY\r\n            originalSubject = Trim(Mid(subject, pos + Len(prefix)))\r\n            GetReportTypeAndSubject = reportType\r\n            Exit Function\r\n        End If\r\n    Next\r\n    \r\n    GetReportTypeAndSubject = reportType\r\nEnd Function\r\n\r\n' ===== EXTRAIR EMAILS DO CORPO =====\r\nFunction ExtractEmailsFromBody(body)\r\n    Dim matches\r\n    Dim emailList\r\n    Dim match\r\n    \r\n    emailList = \"\"\r\n    \r\n    If body <> \"\" Then\r\n        Set matches = g_emailRegex.Execute(body)\r\n        If matches.Count > 0 Then\r\n            For Each match In matches\r\n                If emailList <> \"\" Then emailList = emailList & \"|\"\r\n                emailList = emailList & match.Value\r\n            Next\r\n        Else\r\n            emailList = CFG_MSG_EMAIL_NOT_FOUND\r\n        End If\r\n    Else\r\n        emailList = CFG_MSG_NO_BODY\r\n    End If\r\n    \r\n    ExtractEmailsFromBody = emailList\r\nEnd Function\r\n\r\n' ===== ESCREVER LINHA NO CSV =====\r\nSub WriteCsvLine(originalSubject, reportType, email, creationTime)\r\n    Dim sanitizedSubject\r\n    \r\n    ' Remove delimitador do assunto para evitar problemas no CSV\r\n    sanitizedSubject = Replace(originalSubject, CFG_CSV_DELIMITER, \",\")\r\n    \r\n    g_csvFile.WriteLine sanitizedSubject & CFG_CSV_DELIMITER & _\r\n                        reportType & CFG_CSV_DELIMITER & _\r\n                        email & CFG_CSV_DELIMITER & _\r\n                        creationTime\r\nEnd Sub\r\n\r\n' ===== OBTER EMAIL DO REMETENTE =====\r\nFunction GetSenderEmail(olItem)\r\n    Dim senderEmail\r\n    \r\n    senderEmail = \"\"\r\n    On Error Resume Next\r\n    senderEmail = olItem.SenderEmailAddress\r\n    On Error GoTo 0\r\n    \r\n    GetSenderEmail = senderEmail\r\nEnd Function\r\n\r\n' ===== PROCESSAR ITEM DE RELATORIO =====\r\nSub ProcessReportItem(olItem, itemIndex)\r\n    Dim subject, creationTime, reportType, originalSubject\r\n    Dim body, emailList, emails, email, senderEmail\r\n    \r\n    subject = olItem.Subject\r\n    creationTime = olItem.CreationTime\r\n    \r\n    ' Identifica tipo e extrai assunto original\r\n    reportType = GetReportTypeAndSubject(subject, originalSubject)\r\n    \r\n    ' Extrai corpo do email (com tratamento de erro)\r\n    body = \"\"\r\n    On Error Resume Next\r\n    body = olItem.Body\r\n    On Error GoTo 0\r\n    \r\n    ' Extrai emails do corpo\r\n    emailList = ExtractEmailsFromBody(body)\r\n    \r\n    ' Se nao encontrou email no corpo, usa o email do remetente\r\n    If emailList = CFG_MSG_EMAIL_NOT_FOUND Or emailList = CFG_MSG_NO_BODY Then\r\n        senderEmail = GetSenderEmail(olItem)\r\n        If senderEmail <> \"\" Then\r\n            emailList = senderEmail\r\n        End If\r\n    End If\r\n    \r\n    ' Escreve no CSV (uma linha por email encontrado)\r\n    If emailList = CFG_MSG_EMAIL_NOT_FOUND Or emailList = CFG_MSG_NO_BODY Then\r\n        WriteCsvLine originalSubject, reportType, emailList, creationTime\r\n    Else\r\n        emails = Split(emailList, \"|\")\r\n        For Each email In emails\r\n            WriteCsvLine originalSubject, reportType, email, creationTime\r\n        Next\r\n    End If\r\n    \r\n    ' Guarda item para mover depois\r\n    Set g_processedItems(itemIndex) = olItem\r\nEnd Sub\r\n\r\n' ===== PROCESSAR TODOS OS ITENS DE RELATORIO =====\r\nSub ProcessAllReportItems()\r\n    Dim olItem\r\n    Dim itemIndex\r\n    \r\n    Set g_processedItems = CreateObject(\"Scripting.Dictionary\")\r\n    itemIndex = 0\r\n    \r\n    ' Itera sobre todos os itens da Inbox\r\n    For Each olItem In g_olInbox.Items\r\n        If TypeName(olItem) = \"ReportItem\" Then\r\n            ProcessReportItem olItem, itemIndex\r\n            itemIndex = itemIndex + 1\r\n        End If\r\n    Next\r\nEnd Sub\r\n\r\n' ===== MOVER ITENS PROCESSADOS =====\r\nSub MoveProcessedItems()\r\n    Dim key\r\n    \r\n    For Each key In g_processedItems.Keys\r\n        g_processedItems(key).Move g_olDestinationFolder\r\n    Next\r\nEnd Sub\r\n\r\n' ===== LIBERAR RECURSOS =====\r\nSub Cleanup()\r\n    g_csvFile.Close\r\n    \r\n    Set g_processedItems = Nothing\r\n    Set g_emailRegex = Nothing\r\n    Set g_csvFile = Nothing\r\n    Set g_fso = Nothing\r\n    Set g_olDestinationFolder = Nothing\r\n    Set g_olInbox = Nothing\r\n    Set g_olNamespace = Nothing\r\n    Set g_olApp = Nothing\r\nEnd Sub\r\n\r\n' ===== EXIBIR MENSAGEM DE CONCLUSAO =====\r\nSub ShowCompletionMessage()\r\n    WScript.Echo CFG_MSG_COMPLETION & vbCrLf & _\r\n                 \"Arquivo CSV: \" & CFG_CSV_PATH & vbCrLf & _\r\n                 \"Emails movidos para: \" & CFG_DESTINATION_FOLDER\r\nEnd Sub\r\n\r\n' ===== PONTO DE ENTRADA PRINCIPAL =====\r\nSub Main()\r\n    ' 1. Inicializa parametros de configuracao\r\n    InitializeParameters\r\n    \r\n    ' 2. Inicializa conexao com Outlook\r\n    InitializeOutlook\r\n    \r\n    ' 3. Inicializa arquivo CSV para exportacao\r\n    InitializeCsvFile\r\n    \r\n    ' 4. Inicializa expressao regular para extrair emails\r\n    InitializeEmailRegex\r\n    \r\n    ' 5. Obtem ou cria pasta de destino para itens processados\r\n    GetOrCreateDestinationFolder\r\n    \r\n    ' 6. Processa todos os ReportItems da Inbox\r\n    ProcessAllReportItems\r\n    \r\n    ' 7. Move itens processados para pasta de destino\r\n    MoveProcessedItems\r\n    \r\n    ' 8. Libera recursos\r\n    Cleanup\r\n    \r\n    ' 9. Exibe mensagem de conclusao\r\n    ShowCompletionMessage\r\nEnd Sub\r\n\r\n' ===== EXECUTA O SCRIPT =====\r\nMain\r\n","epoch":3,"telemetryInfo":{}}]],"operations":[{"type":"textEdit","uri":{"$mid":1,"fsPath":"d:\\Repos\\_sk\\Sky.HubAI\\_others_src\\EmailComunicado\\scriptOutLook.vbs","_sep":1,"external":"file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","path":"/d:/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","scheme":"file"},"requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","epoch":4,"edits":[{"text":"Para Entrega: usa diretamente o email do remetente\r\n    ' Para Leitura: extrai do corpo (sem duplicados)\r\n    If reportType = CFG_TYPE_DELIVERY Then\r\n        ' Entrega: o sender é o destinatário que recebeu o email\r\n        senderEmail = GetSenderEmail(olItem)\r\n        If senderEmail <> \"\" Then\r\n            emailList = senderEmail\r\n        Else\r\n            emailList = CFG_MSG_EMAIL_NOT_FOUND\r\n        End If\r\n    Else\r\n        ' Leitura ou Outro: extrai emails do corpo\r\n        emailList = ExtractEmailsFromBody(body)\r\n        \r\n        ' Se nao encontrou email no corpo, usa o email do remetente como fallback\r\n        If emailList = CFG_MSG_EMAIL_NOT_FOUND Or emailList = CFG_MSG_NO_BODY Then\r\n            senderEmail = GetSenderEmail(olItem)\r\n            If senderEmail <> \"\" Then\r\n                emailList = senderEmail\r\n            End If","range":{"startLineNumber":217,"startColumn":7,"endLineNumber":224,"endColumn":36}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"d:\\Repos\\_sk\\Sky.HubAI\\_others_src\\EmailComunicado\\scriptOutLook.vbs","_sep":1,"external":"file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","path":"/d:/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","scheme":"file"},"requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","epoch":5,"edits":[{"text":"(SEM DUPLICADOS) =====\r\nFunction ExtractEmailsFromBody(body)\r\n    Dim matches\r\n    Dim emailList\r\n    Dim match\r\n    Dim emailDict\r\n    Dim emailLower\r\n    \r\n    emailList = \"\"\r\n    Set emailDict = CreateObject(\"Scripting.Dictionary\")\r\n    \r\n    If body <> \"\" Then\r\n        Set matches = g_emailRegex.Execute(body)\r\n        If matches.Count > 0 Then\r\n            For Each match In matches\r\n                emailLower = LCase(match.Value)\r\n                ' Adiciona apenas se ainda não existir (evita duplicados)\r\n                If Not emailDict.Exists(emailLower) Then\r\n                    emailDict.Add emailLower, match.Value\r\n                    If emailList <> \"\" Then emailList = emailList & \"|\"\r\n                    emailList = emailList & match.Value\r\n                End If\r\n            Next\r\n        Else\r\n            emailList = CFG_MSG_EMAIL_NOT_FOUND\r\n        End If\r\n    Else\r\n        emailList = CFG_MSG_NO_BODY\r\n    End If\r\n    \r\n    Set emailDict = Nothing","range":{"startLineNumber":150,"startColumn":33,"endLineNumber":171,"endColumn":5}}]}],"epochCounter":6},"recentSnapshot":{"entries":[{"resource":"file:///d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs","languageId":"vb","originalHash":"41c4b48","currentHash":"41c4b48","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/d%3A/Repos/_sk/Sky.HubAI/_others_src/EmailComunicado/scriptOutLook.vbs?%7B%22session%22%3A%7B%22%24mid%22%3A1%2C%22external%22%3A%22vscode-chat-session%3A%2F%2Flocal%2FMWVlOTJmZGEtNjFkOS00ZjFmLTgzNjQtN2I3YmY1MTJjODll%22%2C%22path%22%3A%22%2FMWVlOTJmZGEtNjFkOS00ZjFmLTgzNjQtN2I3YmY1MTJjODll%22%2C%22scheme%22%3A%22vscode-chat-session%22%2C%22authority%22%3A%22local%22%7D%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_f31dcebd-ae34-4b63-9d5a-24f5f2064fcc","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-opus-4.5","modeId":"agent"}}]}}