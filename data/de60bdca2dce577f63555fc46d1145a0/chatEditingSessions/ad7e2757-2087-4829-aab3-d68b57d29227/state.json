{"version":2,"initialFileContents":[["file:///d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","40d45e0"]],"timeline":{"checkpoints":[{"checkpointId":"ce3a2951-52e3-4a10-b6ae-a10726fe60a0","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"f229d480-3165-45e1-91c9-e8d6191ed2ac","requestId":"request_0b4765a8-18da-4563-b34b-abd29ee5d311","epoch":1,"label":"Request request_0b4765a8-18da-4563-b34b-abd29ee5d311"},{"checkpointId":"623d8b2d-6279-4aab-b469-eff62c53587a","requestId":"request_0b4765a8-18da-4563-b34b-abd29ee5d311","undoStopId":"ea08895b-977f-451a-8f76-238af16b12d7","epoch":2,"label":"Request request_0b4765a8-18da-4563-b34b-abd29ee5d311 - Stop ea08895b-977f-451a-8f76-238af16b12d7"}],"currentEpoch":5,"fileBaselines":[["file:///d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs::request_0b4765a8-18da-4563-b34b-abd29ee5d311",{"uri":{"$mid":1,"fsPath":"d:\\Repos\\_sk\\Sky.HubAI\\src\\Api\\DependencyInjection\\PresentationApplicationBuilderExtensions.cs","_sep":1,"external":"file:///d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","path":"/d:/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","scheme":"file"},"requestId":"request_0b4765a8-18da-4563-b34b-abd29ee5d311","content":"using Microsoft.AspNetCore.Builder;\r\nusing Microsoft.Extensions.Hosting;\r\nusing Sky.HubAI.Api.Middleware;\r\nusing Microsoft.AspNetCore.HttpOverrides;\r\n\r\nnamespace Sky.HubAI.Api.DependencyInjection\r\n{\r\n    public static class PresentationApplicationBuilderExtensions\r\n    {\r\n        public static WebApplication UsePresentation(this WebApplication app)\r\n        {\r\n            ConfigureSwagger(app);\r\n            ConfigureHttpPipeline(app);\r\n\r\n            return app;\r\n        }\r\n\r\n        private static void ConfigureSwagger(WebApplication app)\r\n        {\r\n            if (app.Environment.IsDevelopment())\r\n            {\r\n                app.UseSwagger();\r\n                app.UseSwaggerUI();\r\n            }\r\n        }\r\n\r\n        private static void ConfigureHttpPipeline(WebApplication app)\r\n        {\r\n            // Correlation ID should be first to ensure it's available for all subsequent middleware\r\n            app.UseMiddleware<CorrelationIdMiddleware>();\r\n\r\n            app.UseExceptionHandler();\r\n\r\n            // Honor X-Forwarded-* headers when behind reverse proxies/load balancers\r\n            app.UseForwardedHeaders(new ForwardedHeadersOptions\r\n            {\r\n                ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto\r\n            });\r\n\r\n            // Enforce HTTPS redirection and HSTS outside Development\r\n            if (!app.Environment.IsDevelopment())\r\n            {\r\n                app.UseHsts();\r\n                app.UseHttpsRedirection();\r\n            }\r\n\r\n            // Enable endpoint routing prior to applying CORS so that policies are evaluated correctly\r\n            app.UseRouting();\r\n\r\n            app.UseCors(PresentationConstants.DefaultCorsPolicyName);\r\n\r\n            app.UseMiddleware<ClientTokenAuthMiddleware>();\r\n            app.UseMiddleware<HttpLoggingMiddleware>();\r\n\r\n            app.UseAuthorization();\r\n\r\n            app.MapControllers();\r\n        }\r\n    }\r\n}","epoch":3,"telemetryInfo":{}}]],"operations":[{"type":"textEdit","uri":{"$mid":1,"fsPath":"d:\\Repos\\_sk\\Sky.HubAI\\src\\Api\\DependencyInjection\\PresentationApplicationBuilderExtensions.cs","_sep":1,"external":"file:///d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","path":"/d:/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","scheme":"file"},"requestId":"request_0b4765a8-18da-4563-b34b-abd29ee5d311","epoch":4,"edits":[{"text":"// Clear KnownProxies/KnownNetworks so Azure App Service's load balancer is trusted\r\n            var forwardedHeadersOptions = new ForwardedHeadersOptions\r\n            {\r\n                ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto\r\n            };\r\n            forwardedHeadersOptions.KnownProxies.Clear();\r\n            forwardedHeadersOptions.KnownNetworks.Clear();\r\n            app.UseForwardedHeaders(forwardedHeadersOptions","range":{"startLineNumber":35,"startColumn":13,"endLineNumber":38,"endColumn":14}}]}],"epochCounter":5},"recentSnapshot":{"entries":[{"resource":"file:///d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs","languageId":"csharp","originalHash":"8bde61c","currentHash":"8bde61c","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/d%3A/Repos/_sk/Sky.HubAI/src/Api/DependencyInjection/PresentationApplicationBuilderExtensions.cs?%7B%22session%22%3A%7B%22%24mid%22%3A1%2C%22external%22%3A%22vscode-chat-session%3A%2F%2Flocal%2FYWQ3ZTI3NTctMjA4Ny00ODI5LWFhYjMtZDY4YjU3ZDI5MjI3%22%2C%22path%22%3A%22%2FYWQ3ZTI3NTctMjA4Ny00ODI5LWFhYjMtZDY4YjU3ZDI5MjI3%22%2C%22scheme%22%3A%22vscode-chat-session%22%2C%22authority%22%3A%22local%22%7D%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_0b4765a8-18da-4563-b34b-abd29ee5d311","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-opus-4.6","modeId":"agent"}}]}}